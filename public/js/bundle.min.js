"use strict";function init(){console.log("jquery loaded"),sticky(),windowScrollDown()}function sticky(){$(".sticky").sticky({topSpacing:60})}function windowScrollDown(){var o,t=0;$(window).scroll(function(){o=$(this).scrollTop(),t>o?($(".home-page nav").removeClass("folded"),$(".home-page nav").css("border-bottom","0px solid")):$(".home-page nav").addClass("folded"),t=o,$(window).scrollTop()<1&&$(".home-page nav").addClass("top"),$(window).scrollTop()>1&&$(".home-page nav").removeClass("top"),$(window).scrollTop()>30,$(window).scrollTop()<540&&$(".home-page nav").css("box-shadow","inset 0 -1px 0px 0px rgba(0,0,0,0)"),$(window).scrollTop()>540&&$(".home-page nav").css("box-shadow","inset 0 -1px 0px 0px rgba(0,0,0,0.1)")})}function Account(o){this.getCurrentUser=function(){return o({method:"GET",url:"/api/auth/currentUser"})},this.sendVerifyCode=function(t){return o({method:"POST",url:"/api/verify/phone",data:t})},this.verifyCode=function(t){return o({method:"PUT",url:"/api/verify/phone",data:t})},this.getUserData=function(t){return o({method:"GET",url:"/api/users/"+t})},this.updateUserData=function(t,e){return o({method:"PUT",url:"/api/users/"+t,data:e})}}function Payment(o){this.chargeNow=function(t){return o({method:"POST",url:"/api/payment/chargeNow",data:t})}}function focus(o,t){return function(e){t(function(){o.$broadcast("focusOn",e)},0)}}function homeCtrl(){console.log("homeCtrl loaded")}function authCtrl(o,t,e,n){function r(){t.getToken()&&n.getCurrentUser(t.getToken()).then(function(t){console.log("res @getCurrentUser: ",t.data),o.currentUser=t.data},function(o){e.go("authEntrance")})}console.log("authCtrl loaded"),o.getCurrentUser=function(){r()},o.auth_enter=function(o){console.log("authData: ",o),t.signup(o).then(function(o){t.setToken(o),e.go("dashboard"),console.log("res @auth_enter: ",o.data),r()},function(o){console.log("err @auth_enter: ",o)})},o.authenticate=function(o){t.authenticate(o)},o.logout=function(){t.logout(),e.go("authEntrance")}}function dashboardCtrl(o,t,e,n,r,a){console.log("dashboardCtrl loaded"),n.getCurrentUser(t.getToken()).then(function(o){r.currentUser||(r.currentUser=o.data),console.log("res @getCurrentUser: ",o.data)},function(o){e.go("home")}),o.sendVerifyCode=function(t){if(console.log("phone: ",t),t.length>5){var e={userData:o.currentUser,phone:t};n.sendVerifyCode(e).then(function(o){console.log("res @sendVerifyCode: ",o.data)},function(o){console.log("err @sendVerifyCode: ",o)})}},o.verifyCode=function(t){if(console.log("code: ",t),0!==t.length){var e={userData:o.currentUser,code:t};n.verifyCode(e).then(function(o){console.log("res @verifyCode: ",o.data)},function(o){console.log("err @verifyCode: ",o)})}},o.doCheckout=function(t){console.log("fff"),console.log("token: ",t);var e={stripeToken:t,userData:o.currentUser};a.chargeNow(e).then(function(o){console.log("res: ",o.data)},function(o){console.log("err: ",o)})}}function focusOn(){return function(o,t,e){o.$on("focusOn",function(o,n){n===e.focusOn&&t[0].focus()})}}function toolTip(){return function(o,t,e){angular.element(".tool-tip").on("click mouseleave",hideTooltip),angular.element(".tool-tip").on("mouseenter",showTooltip)}}function hideTooltip(){$(this).tooltip("hide")}function showTooltip(){$(this).tooltip("show")}angular.module("pinchApp",["ui.router","satellizer","ngFileUpload","ngImgCrop","stripe.checkout","angular-loading-bar"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(o,t,e){Stripe.setPublishableKey("pk_test_t1eThhOKl6esrp6f4jyWqU4J"),o.state(home).state(authEntrance).state(dashboard).state(dashboard_payment).state(dashboard_plan).state(dashboard_account),t.otherwise("/")}]);var home={name:"home",url:"/",views:{main:{templateUrl:"/html/home.html",controller:"homeCtrl"}}},authEntrance={name:"authEntrance",url:"/entrance",views:{main:{templateUrl:"/html/entrance.html",controller:"authCtrl"}}},dashboard={name:"dashboard",url:"/dashboard",views:{main:{templateUrl:"/html/dashboard.html",controller:"dashboardCtrl"}}},dashboard_payment={name:"dashboard_payment",url:"/payment",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_payment.html",controller:"dashboardCtrl"}}},dashboard_plan={name:"dashboard_plan",url:"/plan",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_plan.html",controller:"dashboardCtrl"}}},dashboard_account={name:"dashboard_account",url:"/account",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_account.html",controller:"dashboardCtrl"}}};$(document).ready(init),Account.$inject=["$http"],Payment.$inject=["$http"],focus.$inject=["$rootScope","$timeout"],angular.module("pinchApp").service("Account",Account).service("Payment",Payment).factory("focus",focus),authCtrl.$inject=["$scope","$auth","$state","Account"],dashboardCtrl.$inject=["$scope","$auth","$state","Account","$rootScope","Payment"],angular.module("pinchApp").controller("homeCtrl",homeCtrl).controller("authCtrl",authCtrl).controller("dashboardCtrl",dashboardCtrl),angular.module("pinchApp").directive("focusOn",focusOn),angular.module("pinchApp").directive("toolTip",toolTip);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFtb2R1bGUuanMiLCJtYWluLmpzIiwic2VydmljZXMuanMiLCJjb250cm9sbGVycy9jb250cm9sbGVycy5qcyIsImRpcmVjdGl2ZXMvZm9jdXNPbi5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3Rvb2xUaXAuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbImluaXQiLCJjb25zb2xlIiwibG9nIiwic3RpY2t5Iiwid2luZG93U2Nyb2xsRG93biIsIiQiLCJ0b3BTcGFjaW5nIiwic3QiLCJsYXN0U2Nyb2xsVG9wIiwid2luZG93Iiwic2Nyb2xsIiwidGhpcyIsInNjcm9sbFRvcCIsInJlbW92ZUNsYXNzIiwiY3NzIiwiYWRkQ2xhc3MiLCJBY2NvdW50IiwiJGh0dHAiLCJnZXRDdXJyZW50VXNlciIsIm1ldGhvZCIsInVybCIsInNlbmRWZXJpZnlDb2RlIiwidXNlck9iaiIsImRhdGEiLCJ2ZXJpZnlDb2RlIiwiZ2V0VXNlckRhdGEiLCJ1cmlVc2VySWQiLCJ1cGRhdGVVc2VyRGF0YSIsIlBheW1lbnQiLCJjaGFyZ2VOb3ciLCJkYXRhT2JqIiwiZm9jdXMiLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJuYW1lIiwiJGJyb2FkY2FzdCIsImhvbWVDdHJsIiwiYXV0aEN0cmwiLCIkc2NvcGUiLCIkYXV0aCIsIiRzdGF0ZSIsImdldFRva2VuIiwidGhlbiIsInJlcyIsImN1cnJlbnRVc2VyIiwiZXJyIiwiZ28iLCJhdXRoX2VudGVyIiwiYXV0aERhdGEiLCJzaWdudXAiLCJzZXRUb2tlbiIsImF1dGhlbnRpY2F0ZSIsInByb3ZpZGVyIiwibG9nb3V0IiwiZGFzaGJvYXJkQ3RybCIsInBob25lIiwibGVuZ3RoIiwidXNlckRhdGEiLCJjb2RlIiwiZG9DaGVja291dCIsInRva2VuIiwic3RyaXBlVG9rZW4iLCJmb2N1c09uIiwic2NvcGUiLCJlbGVtIiwiYXR0ciIsIiRvbiIsImUiLCJ0b29sVGlwIiwiZWxlbWVudCIsImF0dHJzIiwiYW5ndWxhciIsIm9uIiwiaGlkZVRvb2x0aXAiLCJzaG93VG9vbHRpcCIsInRvb2x0aXAiLCJtb2R1bGUiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIiRhdXRoUHJvdmlkZXIiLCJTdHJpcGUiLCJzZXRQdWJsaXNoYWJsZUtleSIsInN0YXRlIiwiaG9tZSIsImF1dGhFbnRyYW5jZSIsImRhc2hib2FyZCIsImRhc2hib2FyZF9wYXltZW50IiwiZGFzaGJvYXJkX3BsYW4iLCJkYXNoYm9hcmRfYWNjb3VudCIsIm90aGVyd2lzZSIsInZpZXdzIiwibWFpbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInBhcmVudCIsImRhc2hib2FyZF9zZWN0aW9uIiwiZG9jdW1lbnQiLCJyZWFkeSIsIiRpbmplY3QiLCJzZXJ2aWNlIiwiZmFjdG9yeSIsImRpcmVjdGl2ZSJdLCJtYXBwaW5ncyI6IkFBQUEsWUNJQSxTQUFTQSxRQUNMQyxRQUFRQyxJQUFJLGlCQUNaQyxTQUNBQyxtQkFHSixRQUFTRCxVQUNMRSxFQUFFLFdBQVdGLFFBQ1RHLFdBQVksS0FJcEIsUUFBU0Ysb0JBQ0wsR0FDSUcsR0FEQUMsRUFBZ0IsQ0FFcEJILEdBQUVJLFFBQVFDLE9BQU8sV0FFYkgsRUFBS0YsRUFBRU0sTUFBTUMsWUFDSkosRUFBTEQsR0FDQUYsRUFBRSxrQkFBa0JRLFlBQVksVUFDaENSLEVBQUUsa0JBQWtCUyxJQUFJLGdCQUFpQixjQUV6Q1QsRUFBRSxrQkFBa0JVLFNBQVMsVUFFakNQLEVBQWdCRCxFQUVaRixFQUFFSSxRQUFRRyxZQUFjLEdBQ3hCUCxFQUFFLGtCQUFrQlUsU0FBUyxPQUU3QlYsRUFBRUksUUFBUUcsWUFBYyxHQUN4QlAsRUFBRSxrQkFBa0JRLFlBQVksT0FFaENSLEVBQUVJLFFBQVFHLFlBQWMsR0FHeEJQLEVBQUVJLFFBQVFHLFlBQWMsS0FDeEJQLEVBQUUsa0JBQWtCUyxJQUFJLGFBQWMsc0NBRXRDVCxFQUFFSSxRQUFRRyxZQUFjLEtBQ3hCUCxFQUFFLGtCQUFrQlMsSUFBSSxhQUFjLDBD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QUssYUFDTHVFLE9BQ0lDLE1BQ0lDLFlBQWEsdUJBQ2JDLFdBQVksbUJBS3BCUCxtQkFDQXJELEtBQU0sb0JBQ05kLElBQUssV0FDTDJFLE9BQVEsWUFDUkosT0FDSUssbUJBQ0lILFlBQWEsK0JBQ2JDLFdBQVksbUJBSXBCTixnQkFDQXRELEtBQU0saUJBQ05kLElBQUssUUFDTDJFLE9BQVEsWUFDUkosT0FDSUssbUJBQ0lILFlBQWEsNEJBQ2JDLFdBQVksbUJBSXBCTCxtQkFDQXZELEtBQU0sb0JBQ05kLElBQUssV0FDTDJFLE9BQVEsWUFDUkosT0FDSUssbUJBQ0lILFlBQWEsK0JBQ2JDLFdBQVksa0JDMUd4QnpGLEdBQUU0RixVQUFVQyxNQUFNbEcsTUNBbEJnQixRQUFRbUYsU0FBVyxTQUNuQnZFLFFBQVF1RSxTQUFXLFNBQ25CcEUsTUFBTW9FLFNBQVcsYUFBYyxZQUYvQjVCLFFBQ0tLLE9BQU8sWUFDUHdCLFFBQVEsVUFBV3BGLFNBQ25Cb0YsUUFBUSxVQUFXeEUsU0FDbkJ5RSxRQUFRLFFBQVN0RSxPQ0p0Qk0sU0FBUzhELFNBQVcsU0FBVSxRQUFTLFNBQVUsV0FDakQ3QyxjQUFjNkMsU0FBVyxTQUFVLFFBQVMsU0FBVSxVQUFXLGFBQWMsV0FEL0U1QixRQUNLSyxPQUFPLFlBQ1BrQixXQUFXLFdBQVkxRCxVQUN2QjBELFdBQVcsV0FBWXpELFVBQ3ZCeUQsV0FBVyxnQkFBaUJ4QyxlQ0pqQ2lCLFFBQ0tLLE9BQU8sWUFDUDBCLFVBQVUsVUFBV3hDLFNDRjFCUyxRQUNLSyxPQUFPLFlBQ1AwQixVQUFVLFVBQVdsQyIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnLCBbXG4gICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAnc2F0ZWxsaXplcicsXG4gICAgICAgIC8vICd1aS5ib290c3RyYXAnLFxuICAgICAgICAnbmdGaWxlVXBsb2FkJyxcbiAgICAgICAgJ25nSW1nQ3JvcCcsXG4gICAgICAgICdzdHJpcGUuY2hlY2tvdXQnLFxuICAgICAgICAnYW5ndWxhci1sb2FkaW5nLWJhcidcbiAgICBdKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGF1dGhQcm92aWRlcikge1xuICAgICAgICBTdHJpcGUuc2V0UHVibGlzaGFibGVLZXkoJ3BrX3Rlc3RfdDFlVGhoT0tsNmVzcnA2ZjRqeVdxVTRKJylcblxuICAgICAgICAvLyAkYXV0aFByb3ZpZGVyXG4gICAgICAgIC8vICAgICAuZmFjZWJvb2soe1xuICAgICAgICAvLyAgICAgICAgIGNsaWVudElkOiAnMjk4MTY1MTEzODQ5MzY2J1xuICAgICAgICAvLyAgICAgfSk7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZShob21lKVxuICAgICAgICAgICAgLnN0YXRlKGF1dGhFbnRyYW5jZSlcbiAgICAgICAgICAgIC5zdGF0ZShkYXNoYm9hcmQpXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkX3BheW1lbnQpXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkX3BsYW4pXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkX2FjY291bnQpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2UpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfcHJvamVjdHMpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfbGlrZWQpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfZm9sbG93ZXJzKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RwYWdlKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nX2dlbmVyYWwpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHJvamVjdFNldHRpbmdfcmVxdWVzdClcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9qZWN0U2V0dGluZ19wcml2YWN5KVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nX2RhbmdlcilcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZylcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZ19nZW5lcmFsKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2ZpbGVTZXR0aW5nX3JlcXVlc3QpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHJvZmlsZVNldHRpbmdfcHJpdmFjeSlcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZ19kYW5nZXIpXG5cblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgfSk7XG5cblxubGV0IGhvbWUgPSB7XG4gICAgbmFtZTogJ2hvbWUnLFxuICAgIHVybDogJy8nLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIG1haW46IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvaG9tZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdob21lQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbmxldCBhdXRoRW50cmFuY2UgPSB7XG4gICAgbmFtZTogJ2F1dGhFbnRyYW5jZScsXG4gICAgdXJsOiAnL2VudHJhbmNlJyxcbiAgICB2aWV3czoge1xuICAgICAgICBtYWluOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2VudHJhbmNlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2F1dGhDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZCA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkJyxcbiAgICB1cmw6ICcvZGFzaGJvYXJkJyxcbiAgICB2aWV3czoge1xuICAgICAgICBtYWluOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxuXG5sZXQgZGFzaGJvYXJkX3BheW1lbnQgPSB7XG4gICAgbmFtZTogJ2Rhc2hib2FyZF9wYXltZW50JyxcbiAgICB1cmw6ICcvcGF5bWVudCcsXG4gICAgcGFyZW50OiAnZGFzaGJvYXJkJyxcbiAgICB2aWV3czoge1xuICAgICAgICBkYXNoYm9hcmRfc2VjdGlvbjoge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9kYXNoYm9hcmRfcGF5bWVudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZF9wbGFuID0ge1xuICAgIG5hbWU6ICdkYXNoYm9hcmRfcGxhbicsXG4gICAgdXJsOiAnL3BsYW4nLFxuICAgIHBhcmVudDogJ2Rhc2hib2FyZCcsXG4gICAgdmlld3M6IHtcbiAgICAgICAgZGFzaGJvYXJkX3NlY3Rpb246IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGFzaGJvYXJkX3BsYW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbmxldCBkYXNoYm9hcmRfYWNjb3VudCA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkX2FjY291bnQnLFxuICAgIHVybDogJy9hY2NvdW50JyxcbiAgICBwYXJlbnQ6ICdkYXNoYm9hcmQnLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIGRhc2hib2FyZF9zZWN0aW9uOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZF9hY2NvdW50Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZEN0cmwnXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIGxldCBwcGFnZSA9IHtcbi8vICAgICBuYW1lOiAncHBhZ2UnLFxuLy8gICAgIHVybDogJy9tLzp1c2VySWQnLFxuLy8gICAgIHZpZXdzOiB7XG4vLyAgICAgICAgICdtYWluJzoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcGFnZS5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcGFnZUN0cmwnXG4vLyAgICAgICAgIH0sXG4vLyAgICAgICAgICdyaWdodF9zZWN0aW9uJzoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcGFnZV9wcm9qZWN0cy5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcGFnZUN0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vL1xuLy8gbGV0IHBwYWdlX3Byb2plY3RzID0ge1xuLy8gICAgIG5hbWU6ICdwcGFnZV9wcm9qZWN0cycsXG4vLyAgICAgdXJsOiAnL3Byb2plY3RzJyxcbi8vICAgICBwYXJlbnQ6ICdwcGFnZScsXG4vLyAgICAgdmlld3M6IHtcbi8vICAgICAgICAgcmlnaHRfc2VjdGlvbjoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcGFnZV9wcm9qZWN0cy5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcGFnZUN0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vLyBsZXQgcHBhZ2VfbGlrZWQgPSB7XG4vLyAgICAgbmFtZTogJ3BwYWdlX2xpa2VkJyxcbi8vICAgICB1cmw6ICcvbGlrZWQnLFxuLy8gICAgIHBhcmVudDogJ3BwYWdlJyxcbi8vICAgICB2aWV3czoge1xuLy8gICAgICAgICByaWdodF9zZWN0aW9uOiB7XG4vLyAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3BwYWdlX2xpa2VkLmh0bWwnLFxuLy8gICAgICAgICAgICAgY29udHJvbGxlcjogJ3BwYWdlQ3RybCdcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH1cbi8vIGxldCBwcGFnZV9mb2xsb3dlcnMgPSB7XG4vLyAgICAgbmFtZTogJ3BwYWdlX2ZvbGxvd2VycycsXG4vLyAgICAgdXJsOiAnL2ZvbGxvd2VycycsXG4vLyAgICAgcGFyZW50OiAncHBhZ2UnLFxuLy8gICAgIHZpZXdzOiB7XG4vLyAgICAgICAgIHJpZ2h0X3NlY3Rpb246IHtcbi8vICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHBhZ2VfZm9sbG93ZXJzLmh0bWwnLFxuLy8gICAgICAgICAgICAgY29udHJvbGxlcjogJ3BwYWdlQ3RybCdcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH1cbi8vIGxldCBwcm9qZWN0cGFnZSA9IHtcbi8vICAgICBuYW1lOiAncHJvamVjdHBhZ2UnLFxuLy8gICAgIHVybDogJy86cHJvamVjdElkJyxcbi8vICAgICB2aWV3czoge1xuLy8gICAgICAgICBtYWluOiB7XG4vLyAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Byb2plY3RwYWdlLmh0bWwnLFxuLy8gICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RwYWdlQ3RybCdcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH1cbi8vIGxldCBwcm9qZWN0U2V0dGluZyA9IHtcbi8vICAgICBuYW1lOiAncHJvamVjdFNldHRpbmcnLFxuLy8gICAgIHVybDogJy9wcm9qZWN0Lzpwcm9qZWN0SWQvc2V0dGluZycsXG4vLyAgICAgdmlld3M6IHtcbi8vICAgICAgICAgbWFpbjoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9qZWN0U2V0dGluZy5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9qZWN0U2V0dGluZ0N0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vLyBsZXQgcHJvamVjdFNldHRpbmdfZ2VuZXJhbCA9IHtcbi8vICAgICBuYW1lOiAncHJvamVjdFNldHRpbmdfZ2VuZXJhbCcsXG4vLyAgICAgdXJsOiAnL2dlbmVyYWwnLFxuLy8gICAgIHBhcmVudDogJ3Byb2plY3RTZXR0aW5nJyxcbi8vICAgICB2aWV3czoge1xuLy8gICAgICAgICByaWdodF9zZWN0aW9uOiB7XG4vLyAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Byb2plY3RTZXR0aW5nX2dlbmVyYWwuaHRtbCcsXG4vLyAgICAgICAgICAgICBjb250cm9sbGVyOiAncHJvamVjdFNldHRpbmdDdHJsJ1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuLy8gbGV0IHByb2plY3RTZXR0aW5nX3JlcXVlc3QgPSB7XG4vLyAgICAgbmFtZTogJ3Byb2plY3RTZXR0aW5nX3JlcXVlc3QnLFxuLy8gICAgIHVybDogJy9yZXF1ZXN0Jyxcbi8vICAgICBwYXJlbnQ6ICdwcm9qZWN0U2V0dGluZycsXG4vLyAgICAgdmlld3M6IHtcbi8vICAgICAgICAgcmlnaHRfc2VjdGlvbjoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9qZWN0U2V0dGluZ19yZXF1ZXN0Lmh0bWwnLFxuLy8gICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RTZXR0aW5nQ3RybCdcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH1cbi8vIGxldCBwcm9qZWN0U2V0dGluZ19wcml2YWN5ID0ge1xuLy8gICAgIG5hbWU6ICdwcm9qZWN0U2V0dGluZ19wcml2YWN5Jyxcbi8vICAgICB1cmw6ICcvcHJpdmFjeScsXG4vLyAgICAgcGFyZW50OiAncHJvamVjdFNldHRpbmcnLFxuLy8gICAgIHZpZXdzOiB7XG4vLyAgICAgICAgIHJpZ2h0X3NlY3Rpb246IHtcbi8vICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHJvamVjdFNldHRpbmdfcHJpdmFjeS5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9qZWN0U2V0dGluZ0N0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vLyBsZXQgcHJvamVjdFNldHRpbmdfZGFuZ2VyID0ge1xuLy8gICAgIG5hbWU6ICdwcm9qZWN0U2V0dGluZ19kYW5nZXInLFxuLy8gICAgIHVybDogJy9kYW5nZXInLFxuLy8gICAgIHBhcmVudDogJ3Byb2plY3RTZXR0aW5nJyxcbi8vICAgICB2aWV3czoge1xuLy8gICAgICAgICByaWdodF9zZWN0aW9uOiB7XG4vLyAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Byb2plY3RTZXR0aW5nX2Rhbmdlci5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9qZWN0U2V0dGluZ0N0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vLyBsZXQgcHJvZmlsZVNldHRpbmcgPSB7XG4vLyAgICAgbmFtZTogJ3Byb2ZpbGVTZXR0aW5nJyxcbi8vICAgICB1cmw6ICcvdXNlci86dXNlcklkL3NldHRpbmcnLFxuLy8gICAgIHZpZXdzOiB7XG4vLyAgICAgICAgIG1haW46IHtcbi8vICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHJvZmlsZVNldHRpbmcuaHRtbCcsXG4vLyAgICAgICAgICAgICBjb250cm9sbGVyOiAncHJvZmlsZVNldHRpbmdDdHJsJ1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuLy8gbGV0IHByb2ZpbGVTZXR0aW5nX2dlbmVyYWwgPSB7XG4vLyAgICAgbmFtZTogJ3Byb2ZpbGVTZXR0aW5nX2dlbmVyYWwnLFxuLy8gICAgIHVybDogJy9nZW5lcmFsJyxcbi8vICAgICBwYXJlbnQ6ICdwcm9maWxlU2V0dGluZycsXG4vLyAgICAgdmlld3M6IHtcbi8vICAgICAgICAgcmlnaHRfc2VjdGlvbjoge1xuLy8gICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9maWxlU2V0dGluZ19nZW5lcmFsLmh0bWwnLFxuLy8gICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2ZpbGVTZXR0aW5nQ3RybCdcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH1cbi8vIGxldCBwcm9maWxlU2V0dGluZ19yZXF1ZXN0ID0ge1xuLy8gICAgIG5hbWU6ICdwcm9maWxlU2V0dGluZ19yZXF1ZXN0Jyxcbi8vICAgICB1cmw6ICcvcmVxdWVzdCcsXG4vLyAgICAgcGFyZW50OiAncHJvZmlsZVNldHRpbmcnLFxuLy8gICAgIHZpZXdzOiB7XG4vLyAgICAgICAgIHJpZ2h0X3NlY3Rpb246IHtcbi8vICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHJvZmlsZVNldHRpbmdfcmVxdWVzdC5odG1sJyxcbi8vICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlU2V0dGluZ0N0cmwnXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9XG4vLyBsZXQgcHJvZmlsZVNldHRpbmdfcHJpdmFjeSA9IHtcbi8vICAgICBuYW1lOiAncHJvZmlsZVNldHRpbmdfcHJpdmFjeScsXG4vLyAgICAgdXJsOiAnL3ByaXZhY3knLFxuLy8gICAgIHBhcmVudDogJ3Byb2ZpbGVTZXR0aW5nJyxcbi8vICAgICB2aWV3czoge1xuLy8gICAgICAgICByaWdodF9zZWN0aW9uOiB7XG4vLyAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Byb2ZpbGVTZXR0aW5nX3ByaXZhY3kuaHRtbCcsXG4vLyAgICAgICAgICAgICBjb250cm9sbGVyOiAncHJvZmlsZVNldHRpbmdDdHJsJ1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuLy8gbGV0IHByb2ZpbGVTZXR0aW5nX2RhbmdlciA9IHtcbi8vICAgICAgICAgbmFtZTogJ3Byb2ZpbGVTZXR0aW5nX2RhbmdlcicsXG4vLyAgICAgICAgIHVybDogJy9kYW5nZXInLFxuLy8gICAgICAgICBwYXJlbnQ6ICdwcm9maWxlU2V0dGluZycsXG4vLyAgICAgICAgIHZpZXdzOiB7XG4vLyAgICAgICAgICAgICByaWdodF9zZWN0aW9uOiB7XG4vLyAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9maWxlU2V0dGluZ19kYW5nZXIuaHRtbCcsXG4vLyAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2ZpbGVTZXR0aW5nQ3RybCdcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfVxuLy8gICAgIH1cbiIsIid1c2Ugc3RyaWN0J1xuXG4kKGRvY3VtZW50KS5yZWFkeShpbml0KTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBjb25zb2xlLmxvZygnanF1ZXJ5IGxvYWRlZCcpO1xuICAgIHN0aWNreSgpXG4gICAgd2luZG93U2Nyb2xsRG93bigpXG59XG5cbmZ1bmN0aW9uIHN0aWNreSgpIHtcbiAgICAkKFwiLnN0aWNreVwiKS5zdGlja3koe1xuICAgICAgICB0b3BTcGFjaW5nOiA2MFxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIHdpbmRvd1Njcm9sbERvd24oKSB7XG4gICAgdmFyIGxhc3RTY3JvbGxUb3AgPSAwXG4gICAgdmFyIHN0XG4gICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJCh3aW5kb3cpLnNjcm9sbFRvcCgpKTtcbiAgICAgICAgc3QgPSAkKHRoaXMpLnNjcm9sbFRvcCgpO1xuICAgICAgICBpZiAoc3QgPCBsYXN0U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLnJlbW92ZUNsYXNzKCdmb2xkZWQnKVxuICAgICAgICAgICAgJCgnLmhvbWUtcGFnZSBuYXYnKS5jc3MoJ2JvcmRlci1ib3R0b20nLCAnMHB4IHNvbGlkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLmFkZENsYXNzKCdmb2xkZWQnKVxuICAgICAgICB9XG4gICAgICAgIGxhc3RTY3JvbGxUb3AgPSBzdFxuXG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPCAxKSB7XG4gICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLmFkZENsYXNzKCd0b3AnKVxuICAgICAgICB9XG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiAxKSB7XG4gICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLnJlbW92ZUNsYXNzKCd0b3AnKVxuICAgICAgICB9XG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiAzMCkge1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSA8IDU0MCkge1xuICAgICAgICAgICAgJCgnLmhvbWUtcGFnZSBuYXYnKS5jc3MoJ2JveC1zaGFkb3cnLCAnaW5zZXQgMCAtMXB4IDBweCAwcHggcmdiYSgwLDAsMCwwKScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcbiAgICAgICAgICAgICQoJy5ob21lLXBhZ2UgbmF2JykuY3NzKCdib3gtc2hhZG93JywgJ2luc2V0IDAgLTFweCAwcHggMHB4IHJnYmEoMCwwLDAsMC4xKScpO1xuICAgICAgICB9XG5cbiAgICB9KVxufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnKVxuICAgIC5zZXJ2aWNlKCdBY2NvdW50JywgQWNjb3VudClcbiAgICAuc2VydmljZSgnUGF5bWVudCcsIFBheW1lbnQpXG4gICAgLmZhY3RvcnkoJ2ZvY3VzJywgZm9jdXMpXG4gICAgLy8gLmRpcmVjdGl2ZSgnc3RhdGVMb2FkaW5nSW5kaWNhdG9yJywgc3RhdGVMb2FkaW5nSW5kaWNhdG9yKVxuZnVuY3Rpb24gQWNjb3VudCgkaHR0cCkge1xuICAgIHRoaXMuZ2V0Q3VycmVudFVzZXIgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS9hdXRoL2N1cnJlbnRVc2VyYFxuICAgICAgICB9KVxuICAgIH1cbiAgICB0aGlzLnNlbmRWZXJpZnlDb2RlID0gKHVzZXJPYmopID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS92ZXJpZnkvcGhvbmVgLFxuICAgICAgICAgICAgZGF0YTogdXNlck9ialxuICAgICAgICB9KVxuICAgIH1cbiAgICB0aGlzLnZlcmlmeUNvZGUgPSAodXNlck9iaikgPT4ge1xuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgICAgICAgIHVybDogYC9hcGkvdmVyaWZ5L3Bob25lYCxcbiAgICAgICAgICAgIGRhdGE6IHVzZXJPYmpcbiAgICAgICAgfSlcbiAgICB9XG4gICAgdGhpcy5nZXRVc2VyRGF0YSA9ICh1cmlVc2VySWQpID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6IGAvYXBpL3VzZXJzLyR7dXJpVXNlcklkfWBcbiAgICAgICAgfSlcbiAgICB9XG4gICAgdGhpcy51cGRhdGVVc2VyRGF0YSA9ICh1cmlVc2VySWQsIHVwZGF0ZVVzZXJEYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS91c2Vycy8ke3VyaVVzZXJJZH1gLFxuICAgICAgICAgICAgZGF0YTogdXBkYXRlVXNlckRhdGFcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFBheW1lbnQoJGh0dHApe1xuICAgIHRoaXMuY2hhcmdlTm93ID0gKGRhdGFPYmopID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS9wYXltZW50L2NoYXJnZU5vd2AsXG4gICAgICAgICAgICBkYXRhOiBkYXRhT2JqXG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5mdW5jdGlvbiBmb2N1cygkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIHJldHVybiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdmb2N1c09uJywgbmFtZSk7XG4gICAgICAgIH0sIDApO1xuICAgIH1cbn1cblxuLy8gZnVuY3Rpb24gc3RhdGVMb2FkaW5nSW5kaWNhdG9yKCRyb290U2NvcGUpIHtcbi8vICAgICByZXR1cm4ge1xuLy8gICAgICAgICByZXN0cmljdDogJ0UnLFxuLy8gICAgICAgICB0ZW1wbGF0ZTogXCI8ZGl2IG5nLXNob3c9J2lzU3RhdGVMb2FkaW5nJyBjbGFzcz0nbG9hZGluZy1pbmRpY2F0b3InPlwiICtcbi8vICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0nbG9hZGluZy1pbmRpY2F0b3ItYm9keSc+XCIgK1xuLy8gICAgICAgICAgICAgXCI8aDMgY2xhc3M9J2xvYWRpbmctdGl0bGUnPkxvYWRpbmcuLi48L2gzPlwiICtcbi8vICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0nc3Bpbm5lcic+PGNoYXNpbmctZG90cy1zcGlubmVyPjwvY2hhc2luZy1kb3RzLXNwaW5uZXI+PC9kaXY+XCIgK1xuLy8gICAgICAgICAgICAgXCI8L2Rpdj5cIiArXG4vLyAgICAgICAgICAgICBcIjwvZGl2PlwiLFxuLy8gICAgICAgICByZXBsYWNlOiB0cnVlLFxuLy8gICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0cnMpIHtcbi8vICAgICAgICAgICAgIHNjb3BlLmlzU3RhdGVMb2FkaW5nID0gZmFsc2U7XG4vL1xuLy8gICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0Jylcbi8vICAgICAgICAgICAgICAgICBzY29wZS5pc1N0YXRlTG9hZGluZyA9IHRydWU7XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbXBsZXRlJylcbi8vICAgICAgICAgICAgICAgICBzY29wZS5pc1N0YXRlTG9hZGluZyA9IGZhbHNlO1xuLy8gICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9O1xuLy8gfVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnKVxuICAgIC5jb250cm9sbGVyKCdob21lQ3RybCcsIGhvbWVDdHJsKVxuICAgIC5jb250cm9sbGVyKCdhdXRoQ3RybCcsIGF1dGhDdHJsKVxuICAgIC5jb250cm9sbGVyKCdkYXNoYm9hcmRDdHJsJywgZGFzaGJvYXJkQ3RybClcbiAgICAvLyAuY29udHJvbGxlcignbmF2Q3RybCcsIG5hdkN0cmwpXG4gICAgLy8gLmNvbnRyb2xsZXIoJ3BwYWdlQ3RybCcsIHBwYWdlQ3RybClcbiAgICAvLyAuY29udHJvbGxlcigncHJvZmlsZVNldHRpbmdDdHJsJywgcHJvZmlsZVNldHRpbmdDdHJsKVxuICAgIC8vIC5jb250cm9sbGVyKCdwcm9qZWN0cGFnZUN0cmwnLCBwcm9qZWN0cGFnZUN0cmwpXG4gICAgLy8gLmNvbnRyb2xsZXIoJ3Byb2plY3RTZXR0aW5nQ3RybCcsIHByb2plY3RTZXR0aW5nQ3RybClcblxuXG5mdW5jdGlvbiBob21lQ3RybCgpIHtcbiAgICBjb25zb2xlLmxvZygnaG9tZUN0cmwgbG9hZGVkJyk7XG59XG5cbmZ1bmN0aW9uIGF1dGhDdHJsKCRzY29wZSwgJGF1dGgsICRzdGF0ZSwgQWNjb3VudCkge1xuICAgIGNvbnNvbGUubG9nKCdhdXRoQ3RybCBsb2FkZWQnKVxuXG4gICAgJHNjb3BlLmdldEN1cnJlbnRVc2VyID0gKCkgPT4ge1xuICAgICAgICBnZXRDdXJyZW50VXNlcigpXG4gICAgfVxuXG4gICAgJHNjb3BlLmF1dGhfZW50ZXIgPSAoYXV0aERhdGEpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGhEYXRhOiAnLCBhdXRoRGF0YSk7XG4gICAgICAgICRhdXRoLnNpZ251cChhdXRoRGF0YSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgJGF1dGguc2V0VG9rZW4ocmVzKVxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZGFzaGJvYXJkJylcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIEBhdXRoX2VudGVyOiAnLCByZXMuZGF0YSlcbiAgICAgICAgICAgICAgICBnZXRDdXJyZW50VXNlcigpXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5pbmZvKCdZb3UgaGF2ZSBzdWNjZXNzZnVsbHkgY3JlYXRlZCBhIG5ldyBhY2NvdW50IGFuZCBoYXZlIGJlZW4gc2lnbmVkLWluJyk7XG4gICAgICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgQGF1dGhfZW50ZXI6ICcsIGVycilcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICB9KVxuICAgIH1cblxuICAgICRzY29wZS5hdXRoZW50aWNhdGUgPSAocHJvdmlkZXIpID0+IHtcbiAgICAgICAgJGF1dGguYXV0aGVudGljYXRlKHByb3ZpZGVyKTtcbiAgICB9XG4gICAgJHNjb3BlLmxvZ291dCA9ICgpID0+IHtcbiAgICAgICAgJGF1dGgubG9nb3V0KClcbiAgICAgICAgJHN0YXRlLmdvKCdhdXRoRW50cmFuY2UnKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKCkge1xuICAgICAgICBpZiAoJGF1dGguZ2V0VG9rZW4oKSkge1xuICAgICAgICAgICAgQWNjb3VudC5nZXRDdXJyZW50VXNlcigkYXV0aC5nZXRUb2tlbigpKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMgQGdldEN1cnJlbnRVc2VyOiAnLCByZXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gcmVzLmRhdGFcbiAgICAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2F1dGhFbnRyYW5jZScpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5mdW5jdGlvbiBkYXNoYm9hcmRDdHJsKCRzY29wZSwgJGF1dGgsICRzdGF0ZSwgQWNjb3VudCwgJHJvb3RTY29wZSwgUGF5bWVudCkge1xuICAgIGNvbnNvbGUubG9nKCdkYXNoYm9hcmRDdHJsIGxvYWRlZCcpXG4gICAgQWNjb3VudC5nZXRDdXJyZW50VXNlcigkYXV0aC5nZXRUb2tlbigpKVxuICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHJlcy5kYXRhXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIEBnZXRDdXJyZW50VXNlcjogJywgcmVzLmRhdGEpXG4gICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKVxuICAgICAgICB9KVxuXG4gICAgJHNjb3BlLnNlbmRWZXJpZnlDb2RlID0gKHBob25lKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdwaG9uZTogJywgcGhvbmUpXG4gICAgICAgIGlmKHBob25lLmxlbmd0aCA+IDUpe1xuICAgICAgICAgICAgdmFyIHVzZXJPYmogPSB7XG4gICAgICAgICAgICAgICAgdXNlckRhdGE6ICRzY29wZS5jdXJyZW50VXNlcixcbiAgICAgICAgICAgICAgICBwaG9uZTogcGhvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEFjY291bnQuc2VuZFZlcmlmeUNvZGUodXNlck9iailcbiAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIEBzZW5kVmVyaWZ5Q29kZTogJywgcmVzLmRhdGEpXG4gICAgICAgICAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciBAc2VuZFZlcmlmeUNvZGU6ICcsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIC8vICRzdGF0ZS5nbygnaG9tZScpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudmVyaWZ5Q29kZSA9IChjb2RlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb2RlOiAnLCBjb2RlKVxuICAgICAgICBpZihjb2RlLmxlbmd0aCAhPT0gMCl7XG4gICAgICAgICAgICB2YXIgdXNlck9iaiA9IHtcbiAgICAgICAgICAgICAgICB1c2VyRGF0YTogJHNjb3BlLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgICAgIGNvZGU6IGNvZGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEFjY291bnQudmVyaWZ5Q29kZSh1c2VyT2JqKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMgQHZlcmlmeUNvZGU6ICcsIHJlcy5kYXRhKVxuICAgICAgICAgICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgQHZlcmlmeUNvZGU6ICcsIGVycik7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLmRvQ2hlY2tvdXQgPSAodG9rZW4pID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ZmZicpO1xuICAgICAgICBjb25zb2xlLmxvZygndG9rZW46ICcgLHRva2VuKTtcbiAgICAgICAgdmFyIGRhdGFPYmogPSB7XG4gICAgICAgICAgICBzdHJpcGVUb2tlbjogdG9rZW4sXG4gICAgICAgICAgICB1c2VyRGF0YTogJHNjb3BlLmN1cnJlbnRVc2VyXG4gICAgICAgIH1cbiAgICAgICAgUGF5bWVudC5jaGFyZ2VOb3coZGF0YU9iaikudGhlbihyZXM9PntcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXM6ICcsIHJlcy5kYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI6ICcsIGVycik7XG4gICAgICAgIH0pXG4gICAgfVxuXG5cbn1cblxuXG4vLyBmdW5jdGlvbiBwcm9qZWN0U2V0dGluZ0N0cmwoJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCBQcm9qZWN0LCAkc3RhdGUsICRsb2NhdGlvbikge1xuLy8gICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0U2V0dGluZ0N0cmwgbG9hZGVkJyk7XG4vLyAgICAgdmFyIGlzQXV0aG9yID0gZmFsc2U7XG4vLyAgICAgdmFyIHByb2plY3RJZCA9ICRzdGF0ZVBhcmFtcy5wcm9qZWN0SWQ7XG4vL1xuLy8gICAgIFByb2plY3QuZ2V0T25lUG9yamVjdChwcm9qZWN0SWQpLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ3Byb2plY3RzOiAnLCByZXMuZGF0YSk7XG4vLyAgICAgICAgICRzY29wZS5wcm9qZWN0ID0gcmVzLmRhdGE7XG4vLyAgICAgICAgICRzY29wZS51cGRhdGVQcm9qZWN0RGF0YSA9ICRzY29wZS5wcm9qZWN0O1xuLy8gICAgICAgICAkc2NvcGUucHJvamVjdC5hdXRob3IuZm9yRWFjaChhdXRob3IgPT4ge1xuLy8gICAgICAgICAgICAgLy8gaW4gY2FzZSwgcHJvamVjdCBoYXMgbXV0aXBsZSBhdXRob3JzXG4vLyAgICAgICAgICAgICBpZiAoYXV0aG9yLl9pZCA9PSAkc2NvcGUuY3VycmVudFVzZXIuX2lkKSB7XG4vLyAgICAgICAgICAgICAgICAgaXNBdXRob3IgPSB0cnVlO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9KVxuLy8gICAgICAgICBpZiAoaXNBdXRob3IpIHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpc0F1dGhvcicpO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2lzIG5vdCBBdXRob3InKTtcbi8vICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuLy8gICAgICAgICB9XG4vLyAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGdldCB0aGlzIHByb2plY3Q6ICcsIGVycik7XG4vLyAgICAgfSlcbi8vICAgICAkc2NvcGUucmVxdWVzdCA9IHtcbi8vICAgICAgICAgcGVvcGxlOiBbXSxcbi8vICAgICAgICAgc3VwcGx5OiBbXSxcbi8vICAgICAgICAgbW9uZXk6IFtdXG4vLyAgICAgfTtcbi8vXG4vLyAgICAgJHNjb3BlLmluaXQgPSAoKSA9PiB7XG4vLyAgICAgICAgIHZhciBjaGVja1VybCA9ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ2RhbmdlcicpIHx8ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ3JlcXVlc3QnKSB8fCAkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdwcml2YWN5Jylcbi8vICAgICAgICAgaWYgKCFjaGVja1VybCkge1xuLy8gICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9qZWN0U2V0dGluZ19nZW5lcmFsJyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9O1xuLy9cbi8vICAgICAkc2NvcGUuYWRkQ2hvaWNlVG9QZW9wbGUgPSAocGVvcGxlKSA9PiB7XG4vLyAgICAgICAgIGlmICgkc2NvcGUucmVxdWVzdC5wZW9wbGUuaW5kZXhPZihwZW9wbGUpICE9PSAtMSkge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3QucGVvcGxlLnNwbGljZSgkc2NvcGUucmVxdWVzdC5wZW9wbGUuaW5kZXhPZihwZW9wbGUpLCAxKTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0LnBlb3BsZS5wdXNoKHBlb3BsZSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJlcXVlc3QucGVvcGxlKTtcbi8vICAgICB9O1xuLy9cbi8vICAgICAkc2NvcGUuYWRkQ2hvaWNlVG9TdXBwbHkgPSAoc3VwcGx5KSA9PiB7XG4vLyAgICAgICAgIGlmICgkc2NvcGUucmVxdWVzdC5zdXBwbHkuaW5kZXhPZihzdXBwbHkpICE9PSAtMSkge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3Quc3VwcGx5LnNwbGljZSgkc2NvcGUucmVxdWVzdC5zdXBwbHkuaW5kZXhPZihzdXBwbHkpLCAxKTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0LnN1cHBseS5wdXNoKHN1cHBseSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJlcXVlc3Quc3VwcGx5KTtcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLmFkZENob2ljZVRvTW9uZXkgPSAobW9uZXkpID0+IHtcbi8vICAgICAgICAgaWYgKCRzY29wZS5yZXF1ZXN0Lm1vbmV5LmluZGV4T2YobW9uZXkpICE9PSAtMSkge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3QubW9uZXkuc3BsaWNlKCRzY29wZS5yZXF1ZXN0Lm1vbmV5LmluZGV4T2YobW9uZXkpLCAxKTtcbi8vICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0Lm1vbmV5ID0gW107XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdC5tb25leSA9IFtdO1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3QubW9uZXkucHVzaChtb25leSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnJlcXVlc3QubW9uZXkpO1xuLy8gICAgIH1cbi8vICAgICAkc2NvcGUuZGVsZXRlUHJvamVjdCA9IChwcm9qZWN0RnVsbE5hbWUpID0+IHtcbi8vICAgICAgICAgaWYgKCRzY29wZS5kZWxldGVQcm9qZWN0SW5wdXQgPT0gcHJvamVjdEZ1bGxOYW1lKSB7XG4vLyAgICAgICAgICAgICBsZXQgcHJvamVjdElkID0gJHN0YXRlUGFyYW1zLnByb2plY3RJZDtcbi8vICAgICAgICAgICAgIFByb2plY3QuZGVsZXRlT25lKHByb2plY3RJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0IGRlbGV0ZWQnKTtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzOiAnLCByZXMuZGF0YSk7XG4vLyAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcGFnZScsIHtcbi8vICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiAkc2NvcGUuY3VycmVudFVzZXIuX2lkXG4vLyAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGlzIG5vdCBsb2dnZWQgaW4uJyk7XG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ25vJyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5kYW5nZXJOb3RpZmllZCA9IGZhbHNlO1xuLy8gICAgICRzY29wZS5kYW5nZXJOb3RpZnR5ID0gKCkgPT4ge1xuLy8gICAgICAgICAkc2NvcGUuZGFuZ2VyTm90aWZpZWQgPSAhJHNjb3BlLmRhbmdlck5vdGlmaWVkO1xuLy8gICAgIH1cbi8vICAgICAkc2NvcGUuc2FtZVRvVGhlUHJvamVjdE5hbWUgPSAocHJvamVjdEZ1bGxOYW1lKSA9PiB7XG4vLyAgICAgICAgIHJldHVybiAkc2NvcGUuZGVsZXRlUHJvamVjdElucHV0ID09IHByb2plY3RGdWxsTmFtZTtcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLm9rYXlUb0RlbGV0ZSA9IChwcm9qZWN0RnVsbE5hbWUpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJyRzY29wZS5kYW5nZXJOb3RpZmllZDogJywgJHNjb3BlLmRhbmdlck5vdGlmaWVkKTtcbi8vICAgICAgICAgcmV0dXJuICRzY29wZS5kZWxldGVQcm9qZWN0SW5wdXQgPT0gcHJvamVjdEZ1bGxOYW1lICYmICRzY29wZS5kYW5nZXJOb3RpZmllZDtcbi8vICAgICB9XG4vLyB9XG4vL1xuLy8gZnVuY3Rpb24gcHJvamVjdHBhZ2VDdHJsKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgUHJvamVjdCkge1xuLy8gICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0cGFnZUN0cmwgbG9hZGVkJyk7XG4vLyAgICAgJHNjb3BlLnN0YXRlID0ge31cbi8vICAgICAkc2NvcGUuc3RhdGUuaXNBdXRob3IgPSBmYWxzZVxuLy8gICAgIHZhciBwcm9qZWN0SWQgPSAkc3RhdGVQYXJhbXMucHJvamVjdElkO1xuLy8gICAgIC8vIGNvbnNvbGUubG9nKCdwcm9qZWN0SWQ6ICcsIHByb2plY3RJZCk7XG4vLyAgICAgUHJvamVjdC5nZXRPbmVQb3JqZWN0KHByb2plY3RJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZygncHJvamVjdERhdGE6ICcsIHJlcy5kYXRhKTtcbi8vICAgICAgICAgJHNjb3BlLnByb2plY3QgPSByZXMuZGF0YVxuLy8gICAgICAgICBjb25zb2xlLmxvZygnJHNjb3BlLmN1cnJlbnRVc2VyLl9pZDogJywgJHNjb3BlLmN1cnJlbnRVc2VyLl9pZClcbi8vICAgICAgICAgY29uc29sZS5sb2coJyRzY29wZS5wcm9qZWN0LmF1dGhvcjogJywgJHNjb3BlLnByb2plY3QuYXV0aG9yKVxuLy8gICAgICAgICB2YXIgYXV0aG9ycyA9IHJlcy5kYXRhLmF1dGhvclxuLy8gICAgICAgICBmb3IgKHZhciBhdXRob3IgaW4gYXV0aG9ycykge1xuLy8gICAgICAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50VXNlci5faWQgPT0gYXV0aG9yc1thdXRob3JdLl9pZCkge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc3RhdGUuaXNBdXRob3IgPSB0cnVlO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGdldCB0aGlzIHByb2plY3Q6ICcsIGVycik7XG4vLyAgICAgfSlcbi8vICAgICAkc2NvcGUubGlrZSA9IChsaWtlcklkLCBwcm9qZWN0SWQpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2cobGlrZXJJZCwgJ2NsaWNrcyBsaWtlQnRuIG9mJywgcHJvamVjdElkKTtcbi8vICAgICAgICAgaWYgKCRzY29wZS5zdGF0ZS5pc0F1dGhvcikge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2xpa2VFdmVudCB0cmlnZ2VyZWQnKVxuLy8gICAgICAgICAgICAgUHJvamVjdC5saWtlKHByb2plY3RJZCwgbGlrZXJJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlczogJywgcmVzKTtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChyZXMuZGF0YS5ldmVudFR5cGUgPT0gJ2ZvbGxvdycpIHtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2snKTtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnZm9sbHdpbmc6IHJlcywgJywgcmVzLmRhdGEpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGZvbGxvd2VyID0gcmVzLmRhdGEuZm9sbG93ZXJcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB2YXIgZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS5mb2xsb3dpbmdSZWNlaXZlclxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3QucHVzaChmb2xsb3dlcilcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjaGVja0ZvbGxvd1N0YXR1cygpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLmV2ZW50VHlwZSA9PSAndW5mb2xsb3cnKSB7XG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrJyk7XG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ3VuZm9sbHdpbmc6IHJlcywgJywgcmVzLmRhdGEpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIHVuZm9sbG93ZXIgPSByZXMuZGF0YS51bmZvbGxvd2VyXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIHVuZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS51bmZvbGxvd2luZ1JlY2VpdmVyXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGluZGV4ID0gJHNjb3BlLnVzZXIuZm9sbG93ZXJzTGlzdC5pbmRleE9mKGZvbGxvd2VyKVxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3Quc3BsaWNlKGluZGV4LCAxKVxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNoZWNrRm9sbG93U3RhdHVzKClcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH0sIGVyciA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGxpa2UvdW5saWtlOiAnLCBlcnIpXG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuLy9cbi8vIGZ1bmN0aW9uIHByb2ZpbGVTZXR0aW5nQ3RybCgkc2NvcGUsICRodHRwLCAkc3RhdGVQYXJhbXMsIEFjY291bnQsICRzdGF0ZSwgJHdpbmRvdywgVXBsb2FkLCAkbG9jYXRpb24pIHtcbi8vICAgICBjb25zb2xlLmxvZygncHJvZmlsZVNldHRpbmdDdHJsIGxvYWRlZCcpO1xuLy9cbi8vICAgICBpZiAoJHN0YXRlUGFyYW1zLnVzZXJJZCA9PSAkc2NvcGUuY3VycmVudFVzZXIuX2lkKSB7XG4vLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdpc0F1dGhVc2VyJyk7XG4vLyAgICAgICAgICRzY29wZS51cGRhdGVVc2VyRGF0YSA9IGFuZ3VsYXIuY29weSgkc2NvcGUuY3VycmVudFVzZXIpO1xuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdpcyBub3QgQXV0aFVzZXInKTtcbi8vICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4vLyAgICAgfVxuLy8gICAgICRzY29wZS5pbml0ID0gKCkgPT4ge1xuLy8gICAgICAgICB2YXIgY2hlY2tVcmwgPSAkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdkYW5nZXInKSB8fCAkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdyZXF1ZXN0JykgfHwgJGxvY2F0aW9uLiQkcGF0aC5pbmNsdWRlcygncHJpdmFjeScpXG4vLyAgICAgICAgIGlmICghY2hlY2tVcmwpIHtcbi8vICAgICAgICAgICAgICRzdGF0ZS5nbygncHJvZmlsZVNldHRpbmdfZ2VuZXJhbCcpO1xuLy8gICAgICAgICB9XG4vLyAgICAgfTtcbi8vXG4vLyAgICAgJHNjb3BlLnVwZGF0ZVVzZXJEYXRhU3VibWl0dGVkID0gKCkgPT4ge1xuLy8gICAgICAgICB2YXIgdXJpVXNlcklkID0gJHNjb3BlLnVwZGF0ZVVzZXJEYXRhLl9pZDtcbi8vICAgICAgICAgdmFyIHVwZGF0ZVVzZXJEYXRhID0gJHNjb3BlLnVwZGF0ZVVzZXJEYXRhO1xuLy8gICAgICAgICBBY2NvdW50LnVwZGF0ZVVzZXJEYXRhKHVyaVVzZXJJZCwgdXBkYXRlVXNlckRhdGEpLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgICRzY29wZS51cGRhdGVVc2VyRGF0YSA9IHJlcy5kYXRhO1xuLy8gICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbi8vICAgICAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiBnZXQgdXBkYXRlIHVzZXIgZGF0YTogJywgZXJyKTtcbi8vICAgICAgICAgfSlcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLnBob3RvVXBsb2FkaW5nID0gZmFsc2Vcbi8vICAgICAkc2NvcGUudXBsb2FkRmlsZXMgPSAoZmlsZSkgPT4ge1xuLy8gICAgICAgICAkc2NvcGUucGhvdG9VcGxvYWRpbmcgPSB0cnVlO1xuLy8gICAgICAgICB2YXIgZmlsZSA9IGZpbGVbMF1cbi8vICAgICAgICAgdmFyIHVzZXJJZCA9ICRzY29wZS5jdXJyZW50VXNlci5faWQ7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdwaG90bzogJywgZmlsZSk7XG4vLyAgICAgICAgIGlmIChmaWxlKSB7XG4vLyAgICAgICAgICAgICBVcGxvYWQudXBsb2FkKHtcbi8vICAgICAgICAgICAgICAgICB1cmw6IGAvYXBpL3VwbG9hZC8ke3VzZXJJZH1gLFxuLy8gICAgICAgICAgICAgICAgIGRhdGE6IHtcbi8vICAgICAgICAgICAgICAgICAgICAgbmV3RmlsZTogZmlsZVxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIGFmdGVyIHVwbG9hZDogJywgcmVzLmRhdGEpO1xuLy8gICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiB1cGxvYWQgZmlsZTogJywgZXJyKTtcbi8vICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gfVxuLy9cbi8vIGZ1bmN0aW9uIHBwYWdlQ3RybCgkc2NvcGUsICRzdGF0ZSwgJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zLCBQcm9qZWN0LCBBY2NvdW50LCAkdGltZW91dCwgJGxvY2F0aW9uKSB7XG4vLyAgICAgY29uc29sZS5sb2coJ3BwYWdlQ3RybCBsb2FkZWQnKVxuLy8gICAgICRzY29wZS5zdGF0ZSA9IHt9XG4vLyAgICAgJHNjb3BlLnN0YXRlLmlzVGhlVXNlciA9IGZhbHNlXG4vLyAgICAgJHNjb3BlLnN0YXRlLmZvbGxvd1N0YXR1cyA9IGZhbHNlXG4vLyAgICAgdmFyIGRpc3BsYXlVc2VyO1xuLy8gICAgIHZhciB1cmlVc2VySWQgPSAkc3RhdGVQYXJhbXMudXNlcklkO1xuLy8gICAgIGlmICh1cmlVc2VySWQgPT0gJHNjb3BlLmN1cnJlbnRVc2VyLl9pZCkge1xuLy8gICAgICAgICAkc2NvcGUuc3RhdGUuaXNUaGVVc2VyID0gdHJ1ZTtcbi8vICAgICB9XG4vLyAgICAgaWYgKCRzY29wZS5zdGF0ZS5pc1RoZVVzZXIpIHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2lzVGhlVXNlcicpXG4vLyAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2lzIG5vdCBUaGVVc2VyJylcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLmluaXQgPSAoKSA9PiB7XG4vLyAgICAgICAgIGNoZWNraW5nVXJsKClcbi8vICAgICB9XG4vL1xuLy8gICAgIGZ1bmN0aW9uIGNoZWNraW5nVXJsKCkge1xuLy8gICAgICAgICB2YXIgY2hlY2tVcmwgPSAkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdzdGFycmVkJykgfHwgJGxvY2F0aW9uLiQkcGF0aC5pbmNsdWRlcygnZm9sbG93ZXJzJylcbi8vICAgICAgICAgaWYgKCFjaGVja1VybCkge1xuLy8gICAgICAgICAgICAgJHN0YXRlLmdvKCdwcGFnZV9wcm9qZWN0cycpO1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gICAgIEFjY291bnQuZ2V0VXNlckRhdGEodXJpVXNlcklkKS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgICRzY29wZS51c2VyID0gcmVzLmRhdGFcbi8vICAgICAgICAgZGlzcGxheVVzZXIgPSByZXMuZGF0YVxuLy8gICAgICAgICAkc2NvcGUucHJvamVjdHMgPSByZXMuZGF0YS5wcm9qZWN0cy5yZXZlcnNlKCk7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdjYXJkcyBoZXJlOiAnLCByZXMuZGF0YS5wcm9qZWN0cyk7XG4vLyAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICAgY2hlY2tGb2xsb3dTdGF0dXMoKVxuLy8gICAgICAgICB9LCAwKVxuLy8gICAgIH0sIGVyciA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiBnZXQgdXNlckRhdGE6ICcsIGVycik7XG4vLyAgICAgfSlcbi8vXG4vLyAgICAgJHNjb3BlLmNyZWF0ZVRpbWUgPSAoY3JlYXRlQXRUaW1lKSA9PiB7XG4vLyAgICAgICAgIHJldHVybiBtb21lbnQoY3JlYXRlQXRUaW1lKS5mcm9tTm93KCk7XG4vLyAgICAgfVxuLy9cbi8vICAgICAkc2NvcGUuZm9sbG93ID0gKGN1cnJlbnRVc2VyLCBmb2xsb3dUYXJnZXQpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2ZmZmZmZicpO1xuLy8gICAgICAgICBjb25zb2xlLmxvZyhjdXJyZW50VXNlciwgZm9sbG93VGFyZ2V0KTtcbi8vICAgICAgICAgaWYgKGN1cnJlbnRVc2VyICE9PSBmb2xsb3dUYXJnZXQgJiYgZm9sbG93VGFyZ2V0ID09IHVyaVVzZXJJZCkge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZvbGxvd0V2ZW50IHRyaWdnZXJlZCcpXG4vLyAgICAgICAgICAgICBBY2NvdW50LmZvbGxvdyhjdXJyZW50VXNlciwgZm9sbG93VGFyZ2V0KS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlczogJywgcmVzKTtcbi8vICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuZXZlbnRUeXBlID09ICdmb2xsb3cnKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVjaycpO1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZm9sbHdpbmc6IHJlcywgJywgcmVzLmRhdGEpXG4vLyAgICAgICAgICAgICAgICAgICAgIHZhciBmb2xsb3dlciA9IHJlcy5kYXRhLmZvbGxvd2VyXG4vLyAgICAgICAgICAgICAgICAgICAgIHZhciBmb2xsb3dpbmdSZWNlaXZlciA9IHJlcy5kYXRhLmZvbGxvd2luZ1JlY2VpdmVyXG4vLyAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3QucHVzaChmb2xsb3dlcilcbi8vICAgICAgICAgICAgICAgICAgICAgY2hlY2tGb2xsb3dTdGF0dXMoKVxuLy8gICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmRhdGEuZXZlbnRUeXBlID09ICd1bmZvbGxvdycpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrJyk7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1bmZvbGx3aW5nOiByZXMsICcsIHJlcy5kYXRhKVxuLy8gICAgICAgICAgICAgICAgICAgICB2YXIgdW5mb2xsb3dlciA9IHJlcy5kYXRhLnVuZm9sbG93ZXJcbi8vICAgICAgICAgICAgICAgICAgICAgdmFyIHVuZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS51bmZvbGxvd2luZ1JlY2VpdmVyXG4vLyAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3QuaW5kZXhPZihmb2xsb3dlcilcbi8vICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuZm9sbG93ZXJzTGlzdC5zcGxpY2UoaW5kZXgsIDEpXG4vLyAgICAgICAgICAgICAgICAgICAgIGNoZWNrRm9sbG93U3RhdHVzKClcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiBmb2xsb3cvdW5mb2xsb3c6ICcsIGVycilcbi8vICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgdmFyIGNoZWNrRm9sbG93U3RhdHVzID0gKCkgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrRm9sbG93U3RhdHVzIHRyaWdlcnJlZCcpO1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2Rpc3BsYXlVc2VyOiAnLCBkaXNwbGF5VXNlcik7XG4vLyAgICAgICAgICAgICBpZiAoZGlzcGxheVVzZXIuZm9sbG93ZXJzTGlzdC5sZW5ndGggPiAwKSB7XG4vLyAgICAgICAgICAgICAgICAgdmFyIGZvbGxvd2Vyc0xpc3QgPSBkaXNwbGF5VXNlci5mb2xsb3dlcnNMaXN0XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQnKTtcbi8vICAgICAgICAgICAgICAgICBmb3IgKHZhciBmb2xsb3dlciBpbiBmb2xsb3dlcnNMaXN0KSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjdXJyZW50VXNlcjogJywgJHNjb3BlLmN1cnJlbnRVc2VyLl9pZCk7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmb2xsb3dlcnNMaXN0W2ZvbGxvd2VyXS5faWQ6ICcsIGZvbGxvd2Vyc0xpc3RbZm9sbG93ZXJdLl9pZCk7XG4vLyAgICAgICAgICAgICAgICAgICAgIGlmIChmb2xsb3dlcnNMaXN0W2ZvbGxvd2VyXS5faWQgPT0gJHNjb3BlLmN1cnJlbnRVc2VyLl9pZCkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YXRlLmZvbGxvd1N0YXR1cyA9IHRydWVcbi8vICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0ZS5mb2xsb3dTdGF0dXMgPSBmYWxzZVxuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdGUuZm9sbG93U3RhdHVzID0gZmFsc2Vcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfVxuLy8gICAgICAgICAvLyBjaGVja0ZvbGxvd1N0YXR1cygpXG4vLyB9XG4vL1xuLy8gZnVuY3Rpb24gbmF2Q3RybCgkaHR0cCwgJHNjb3BlLCAkYXV0aCwgQWNjb3VudCwgJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgZm9jdXMsIFByb2plY3QsICRsb2NhdGlvbikge1xuLy8gICAgIC8vIGNvbnNvbGUubG9nKCduYXZDdHJsIGxvYWRlZCcpO1xuLy8gICAgICRzY29wZS5jdXJyZW50VXNlciA9ICcnO1xuLy8gICAgICRzY29wZS5sb2dpbmxvYWRpbmcgPSBmYWxzZTtcbi8vICAgICAkc2NvcGUubG9nb3V0bG9hZGluZyA9IGZhbHNlO1xuLy8gICAgICRyb290U2NvcGUuaGlkZU5hdiA9IGZhbHNlO1xuLy8gICAgICRyb290U2NvcGUuY3JlYXRlTW9kYWwgPSBmYWxzZTtcbi8vXG4vLyAgICAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IChwcm92aWRlcikgPT4ge1xuLy8gICAgICAgICAgICAgJHNjb3BlLmxvZ2lubG9hZGluZyA9IHRydWU7XG4vLyAgICAgICAgICAgICAkYXV0aC5hdXRoZW50aWNhdGUocHJvdmlkZXIpLnRoZW4oZGF0YSA9PiB7XG4vLyAgICAgICAgICAgICAgICAgQWNjb3VudC5nZXRDdXJyZW50VXNlcigpLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXIgbG9nZ2VkIGluOiAnLCByZXMuZGF0YSk7XG4vLyAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlciA9IHJlcy5kYXRhO1xuLy8gICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9naW5sb2FkaW5nID0gZmFsc2U7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCckc2NvcGUuY3VycmVudFVzZXIuX2lkOiAnLCAkc2NvcGUuY3VycmVudFVzZXIuX2lkKTtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT0gJ2hvbWUnKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3BwYWdlJywge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogJHNjb3BlLmN1cnJlbnRVc2VyLl9pZFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXIgaXMgbm90IGxvZ2dlZCBpbi4nKTtcbi8vICAgICAgICAgICAgICAgICB9KVxuLy8gICAgICAgICAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyIHdoZW4gbG9nIHVzZXIgaW46ICcsIGVycik7XG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9XG4vLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKCckYXV0aC5pc0F1dGhlbnRpY2F0ZWQoKSk6ICcsICRhdXRoLmlzQXV0aGVudGljYXRlZCgpKSk7XG4vLyAgICAgaWYgKCRhdXRoLmlzQXV0aGVudGljYXRlZCgpKSB7XG4vLyAgICAgICAgIEFjY291bnQuZ2V0Q3VycmVudFVzZXIoKS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSByZXMuZGF0YTtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCduYXZDdHJsIHRyaWdnZXJlZCBhbmQgY3VycmVudFVzZXI6ICcsICRzY29wZS5jdXJyZW50VXNlcik7XG4vLyAgICAgICAgIH0sIGVyciA9PiB7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZygndXNlciBpcyBub3QgbG9nZ2VkIGluLicpO1xuLy8gICAgICAgICB9KVxuLy8gICAgIH1cbi8vXG4vLyAgICAgJHNjb3BlLmlzQXV0aGVudGljYXRlZCA9ICgpID0+IHtcbi8vICAgICAgICAgcmV0dXJuICRhdXRoLmlzQXV0aGVudGljYXRlZCgpO1xuLy8gICAgIH1cbi8vXG4vLyAgICAgJHNjb3BlLmxvZ291dCA9ICgpID0+IHtcbi8vICAgICAgICAgJHNjb3BlLmxvZ291dGxvYWRpbmcgPSB0cnVlO1xuLy8gICAgICAgICAkYXV0aC5sb2dvdXQoKTtcbi8vICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICAkc2NvcGUubG9nb3V0bG9hZGluZyA9IGZhbHNlO1xuLy8gICAgICAgICAgICAgLy8gJHN0YXRlLmdvKCdob21lJyk7XG4vLyAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgICAgICB9LCAwKVxuLy8gICAgIH1cbi8vXG4vLyAgICAgJHNjb3BlLmdvcHBhZ2UgPSAoKSA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCckbG9jYXRpb24uJCRwYXRoOiAnLCAkbG9jYXRpb24uJCRwYXRoKTtcbi8vICAgICAgICAgaWYgKCRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ3Byb2plY3RzJykpIHtcbi8vICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzdGF5IG9uIHRoZSBwYWdlLCBvciByZWZyZXNoIHRoZSBwYWdlJylcbi8vICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICRzdGF0ZS5nbygncHBhZ2UnLCB7XG4vLyAgICAgICAgICAgICAgICAgdXNlcklkOiAkc2NvcGUuY3VycmVudFVzZXIuX2lkXG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy9cbi8vICAgICAkc2NvcGUuY3JlYXRlID0gKCkgPT4ge1xuLy8gICAgICAgICAkc2NvcGUucHJvamVjdEluaXRhbGl6aW5nID0gZmFsc2U7XG4vLyAgICAgICAgICRzY29wZS5uZXdQcm9qZWN0TmFtZSA9ICcnO1xuLy8gICAgICAgICAkc2NvcGUubmV3UHJvamVjdFBpdGNoID0gJyc7XG4vLyAgICAgICAgICRzY29wZS5jcmVhdGVNb2RhbCA9IHRydWU7XG4vLyAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICAgZm9jdXMoJ2ZvY3VzTWUnKTtcbi8vICAgICAgICAgfSwgMTAwKVxuLy8gICAgIH1cbi8vICAgICAkc2NvcGUuY3JlYXRlUHJvamVjdCA9ICgpID0+IHtcbi8vICAgICAgICAgJHNjb3BlLnByb2plY3RJbml0YWxpemluZyA9IHRydWU7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGUgcHJvamVjdCBjYWxsZWQ6ICcsICRzY29wZS5uZXdQcm9qZWN0TmFtZSk7XG4vLyAgICAgICAgIHZhciBuZXdQb2plY3RPYmogPSB7XG4vLyAgICAgICAgICAgICB0aXRsZTogJHNjb3BlLm5ld1Byb2plY3ROYW1lLFxuLy8gICAgICAgICAgICAgcGl0Y2g6ICRzY29wZS5uZXdQcm9qZWN0UGl0Y2hcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBQcm9qZWN0LmNyZWF0ZU9uZShuZXdQb2plY3RPYmopLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGQgbmV3IGJlaGF2aW9yW2NyZWF0ZU5ld1Byb2plY3RdOiAnLCByZXMuZGF0YSk7XG4vLyAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbi8vICAgICAgICAgICAgICAgICAkc2NvcGUucHJvamVjdEluaXRhbGl6aW5nID0gZmFsc2U7XG4vLyAgICAgICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZU1vZGFsID0gZmFsc2U7XG4vLyAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT0gJ3BwYWdlJykge1xuLy8gICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygncHBhZ2UnLCB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6ICRzY29wZS5jdXJyZW50VXNlci5faWRcbi8vICAgICAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfSwgTWF0aC5yYW5kb20oKSAqIDE1MDAgKyAzMDApO1xuLy8gICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGNyZWF0ZSBwcm9qZWN0OiAnLCBlcnIpO1xuLy8gICAgICAgICB9KVxuLy8gICAgIH1cbi8vIH1cbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ3BpbmNoQXBwJylcbiAgICAuZGlyZWN0aXZlKCdmb2N1c09uJywgZm9jdXNPbilcblxuZnVuY3Rpb24gZm9jdXNPbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW0sIGF0dHIpIHtcbiAgICAgICAgc2NvcGUuJG9uKCdmb2N1c09uJywgZnVuY3Rpb24oZSwgbmFtZSkge1xuICAgICAgICAgICAgaWYgKG5hbWUgPT09IGF0dHIuZm9jdXNPbikge1xuICAgICAgICAgICAgICAgIGVsZW1bMF0uZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ3BpbmNoQXBwJylcbiAgICAuZGlyZWN0aXZlKCd0b29sVGlwJywgdG9vbFRpcClcblxuZnVuY3Rpb24gdG9vbFRpcCgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLnRvb2wtdGlwJykub24oJ2NsaWNrIG1vdXNlbGVhdmUnLCBoaWRlVG9vbHRpcCk7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLnRvb2wtdGlwJykub24oJ21vdXNlZW50ZXInLCBzaG93VG9vbHRpcCk7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gaGlkZVRvb2x0aXAoKSB7XG4gICAgJCh0aGlzKS50b29sdGlwKCdoaWRlJyk7XG59XG5cbmZ1bmN0aW9uIHNob3dUb29sdGlwKCkge1xuICAgICQodGhpcykudG9vbHRpcCgnc2hvdycpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
