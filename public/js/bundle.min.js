"use strict";function init(){console.log("jquery loaded"),sticky(),windowScrollDown()}function sticky(){$(".sticky").sticky({topSpacing:60})}function windowScrollDown(){var o,t=0;$(window).scroll(function(){o=$(this).scrollTop(),$(window).scrollTop()>30&&(t>o?($(".home-page nav").removeClass("folded"),$(".home-page nav").css("border-bottom","0px solid")):$(".home-page nav").addClass("folded")),t=o,$(window).scrollTop()<10&&$(".home-page nav").addClass("top"),$(window).scrollTop()>10&&$(".home-page nav").removeClass("top"),$(window).scrollTop()>30,$(window).scrollTop()<540&&$(".home-page nav").css("box-shadow","inset 0 -1px 0px 0px rgba(0,0,0,0)"),$(window).scrollTop()>540&&$(".home-page nav").css("box-shadow","inset 0 -1px 0px 0px rgba(0,0,0,0.1)")})}function Account(o){this.getCurrentUser=function(){return o({method:"GET",url:"/api/auth/currentUser"})},this.sendVerifyCode=function(t){return o({method:"POST",url:"/api/verify/phone",data:t})},this.verifyCode=function(t){return o({method:"PUT",url:"/api/verify/phone",data:t})},this.getUserData=function(t){return o({method:"GET",url:"/api/users/"+t})},this.updateUserData=function(t,e){return o({method:"PUT",url:"/api/users/"+t,data:e})}}function Payment(o){this.chargeNow=function(t){return o({method:"POST",url:"/api/payment/chargeNow",data:t})}}function focus(o,t){return function(e){t(function(){o.$broadcast("focusOn",e)},0)}}function focusOn(){return function(o,t,e){o.$on("focusOn",function(o,a){a===e.focusOn&&t[0].focus()})}}function toolTip(){return function(o,t,e){angular.element(".tool-tip").on("click mouseleave",hideTooltip),angular.element(".tool-tip").on("mouseenter",showTooltip)}}function hideTooltip(){$(this).tooltip("hide")}function showTooltip(){$(this).tooltip("show")}function homeCtrl(o){console.log("homeCtrl loaded"),o.previousState,o.currentState,o.$on("$stateChangeSuccess",function(t,e,a,n,r){o.previousState=n.name,o.currentState=e.name,console.log("Previous state:"+o.previousState),console.log("Current state:"+o.currentState)}),o.$on("animStart",function(o,t,e){}),o.$on("animEnd",function(o,t,e){})}function authCtrl(o,t,e,a,n){function r(){t.getToken()&&a.getCurrentUser(t.getToken()).then(function(t){console.log("res @getCurrentUser: ",t.data),o.currentUser=t.data},function(o){e.go("authEntrance")})}console.log("authCtrl loaded"),o.getCurrentUser=function(){r()},o.auth_enter=function(o){t.signup(o).then(function(o){t.setToken(o),e.go("dashboard",{},{reload:!0}),console.log("res @auth_enter: ",o.data),r()},function(o){console.log("err @auth_enter: ",o)})},o.authenticate=function(o){t.authenticate(o)},o.logout=function(){t.logout(),o.currentUser=null,e.go("home",{},{reload:!0}),n.location.reload()}}function dashboardCtrl(o,t,e,a,n,r,l){function s(t){o.verifyPhoneSentOut=!1;var e=Number(t.phone.verifyCode.expiredAt),a=Date.now();e>a&&(o.verifyPhoneSentOut=!0),o.verifyPhoneCountDown=function(){return""+e}}console.log("dashboardCtrl loaded"),a.getCurrentUser(t.getToken()).then(function(o){n.currentUser||(n.currentUser=o.data),console.log("res @getCurrentUser: ",o.data),s(o.data)},function(o){e.go("home")}),o.sendVerifyCode=function(t){if(console.log("phone: ",t),t.length>5){var e={userData:n.currentUser,phone:t};a.sendVerifyCode(e).then(function(e){console.log("res @sendVerifyCode: ",e.data),n.currentUser.phone.data=t,o.verifyPhoneSentOut=!0},function(o){console.log("err @sendVerifyCode: ",o)})}},o.verifyCode=function(o){if(console.log("code: ",o),0!==o.length){var t={userData:n.currentUser,code:o};a.verifyCode(t).then(function(o){console.log("res @verifyCode: ",o.data),n.currentUser.phone.verified=!0},function(o){console.log("err @verifyCode: ",o)})}},o.doCheckout=function(o){console.log("fff"),console.log("token: ",o);var t={stripeToken:o,userData:n.currentUser};r.chargeNow(t).then(function(o){console.log("res: ",o.data)},function(o){console.log("err: ",o)})},o.installmentsGraphData=[],o.updateTimes=function(t){o.installmentsGraphData=[];for(var e=0;t>e;e++){var a=~~(o.plan.total/t),n=~~(200*(2/t));o.installmentsGraphData.push({price:a,style:{height:n+"px",width:"90%"}})}}}angular.module("pinchApp",["ui.router","satellizer","ngAnimate","ngFileUpload","ngImgCrop","stripe.checkout","angular-loading-bar","anim-in-out"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(o,t,e){Stripe.setPublishableKey("pk_test_t1eThhOKl6esrp6f4jyWqU4J"),o.state(home).state(authEntrance).state(dashboard).state(dashboard_payment).state(dashboard_plan).state(dashboard_plan_start).state(dashboard_plan_choose).state(dashboard_plan_single).state(dashboard_plan_multiple).state(dashboard_account),t.otherwise("/")}]);var home={name:"home",url:"/",views:{main:{templateUrl:"/html/home.html",controller:"homeCtrl"}}},authEntrance={name:"authEntrance",url:"/entrance",views:{main:{templateUrl:"/html/entrance.html",controller:"authCtrl"}}},dashboard={name:"dashboard",url:"/dashboard",views:{main:{templateUrl:"/html/dashboard.html",controller:"dashboardCtrl"}}},dashboard_payment={name:"dashboard_payment",url:"/payment",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_payment.html",controller:"dashboardCtrl"}}},dashboard_plan={name:"dashboard_plan",url:"/plan",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_plan.html",controller:"dashboardCtrl"}}},dashboard_plan_start={name:"dashboard_plan_start",url:"/start",parent:"dashboard_plan",views:{dashboard_child_section:{templateUrl:"/html/dashboard/dashboard_plan_start.html",controller:"dashboardCtrl"}}},dashboard_plan_choose={name:"dashboard_plan_choose",url:"/choose",parent:"dashboard_plan",views:{dashboard_child_section:{templateUrl:"/html/dashboard/dashboard_plan_choose.html",controller:"dashboardCtrl"}}},dashboard_plan_single={name:"dashboard_plan_single",url:"/choose/single",parent:"dashboard_plan",views:{dashboard_child_section:{templateUrl:"/html/dashboard/dashboard_plan_single.html",controller:"dashboardCtrl"}}},dashboard_plan_multiple={name:"dashboard_plan_multiple",url:"/choose/mutiple",parent:"dashboard_plan",views:{dashboard_child_section:{templateUrl:"/html/dashboard/dashboard_plan_multiple.html",controller:"dashboardCtrl"}}},dashboard_account={name:"dashboard_account",url:"/account",parent:"dashboard",views:{dashboard_section:{templateUrl:"/html/dashboard_account.html",controller:"dashboardCtrl"}}};$(document).ready(init),Account.$inject=["$http"],Payment.$inject=["$http"],focus.$inject=["$rootScope","$timeout"],angular.module("pinchApp").service("Account",Account).service("Payment",Payment).factory("focus",focus),angular.module("pinchApp").directive("focusOn",focusOn),angular.module("pinchApp").directive("toolTip",toolTip),homeCtrl.$inject=["$rootScope"],authCtrl.$inject=["$scope","$auth","$state","Account","$window"],dashboardCtrl.$inject=["$scope","$auth","$state","Account","$rootScope","Payment","$interval"],angular.module("pinchApp").controller("homeCtrl",homeCtrl).controller("authCtrl",authCtrl).controller("dashboardCtrl",dashboardCtrl);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFtb2R1bGUuanMiLCJtYWluLmpzIiwic2VydmljZXMuanMiLCJkaXJlY3RpdmVzL2ZvY3VzT24uZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy90b29sVGlwLmRpcmVjdGl2ZS5qcyIsImNvbnRyb2xsZXJzL2NvbnRyb2xsZXJzLmpzIl0sIm5hbWVzIjpbImluaXQiLCJjb25zb2xlIiwibG9nIiwic3RpY2t5Iiwid2luZG93U2Nyb2xsRG93biIsIiQiLCJ0b3BTcGFjaW5nIiwic3QiLCJsYXN0U2Nyb2xsVG9wIiwid2luZG93Iiwic2Nyb2xsIiwidGhpcyIsInNjcm9sbFRvcCIsInJlbW92ZUNsYXNzIiwiY3NzIiwiYWRkQ2xhc3MiLCJBY2NvdW50IiwiJGh0dHAiLCJnZXRDdXJyZW50VXNlciIsIm1ldGhvZCIsInVybCIsInNlbmRWZXJpZnlDb2RlIiwidXNlck9iaiIsImRhdGEiLCJ2ZXJpZnlDb2RlIiwiZ2V0VXNlckRhdGEiLCJ1cmlVc2VySWQiLCJ1cGRhdGVVc2VyRGF0YSIsIlBheW1lbnQiLCJjaGFyZ2VOb3ciLCJkYXRhT2JqIiwiZm9jdXMiLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJuYW1lIiwiJGJyb2FkY2FzdCIsImZvY3VzT24iLCJzY29wZSIsImVsZW0iLCJhdHRyIiwiJG9uIiwiZSIsInRvb2xUaXAiLCJlbGVtZW50IiwiYXR0cnMiLCJhbmd1bGFyIiwib24iLCJoaWRlVG9vbHRpcCIsInNob3dUb29sdGlwIiwidG9vbHRpcCIsImhvbWVDdHJsIiwicHJldmlvdXNTdGF0ZSIsImN1cnJlbnRTdGF0ZSIsImV2IiwidG8iLCJ0b1BhcmFtcyIsImZyb20iLCJmcm9tUGFyYW1zIiwiJGV2ZW50Iiwic3BlZWQiLCJhdXRoQ3RybCIsIiRzY29wZSIsIiRhdXRoIiwiJHN0YXRlIiwiJHdpbmRvdyIsImdldFRva2VuIiwidGhlbiIsInJlcyIsImN1cnJlbnRVc2VyIiwiZXJyIiwiZ28iLCJhdXRoX2VudGVyIiwiYXV0aERhdGEiLCJzaWdudXAiLCJzZXRUb2tlbiIsInJlbG9hZCIsImF1dGhlbnRpY2F0ZSIsInByb3ZpZGVyIiwibG9nb3V0IiwibG9jYXRpb24iLCJkYXNoYm9hcmRDdHJsIiwiJGludGVydmFsIiwiY2hlY2tWZXJpZnlQaG9uZVNlbnRTdGF0dXMiLCJjdXJyZW50VXNlckRhdGEiLCJ2ZXJpZnlQaG9uZVNlbnRPdXQiLCJleHBpcmVkVGltZSIsIk51bWJlciIsInBob25lIiwiZXhwaXJlZEF0Iiwibm93VGltZSIsIkRhdGUiLCJub3ciLCJ2ZXJpZnlQaG9uZUNvdW50RG93biIsImxlbmd0aCIsInVzZXJEYXRhIiwiY29kZSIsInZlcmlmaWVkIiwiZG9DaGVja291dCIsInRva2VuIiwic3RyaXBlVG9rZW4iLCJpbnN0YWxsbWVudHNHcmFwaERhdGEiLCJ1cGRhdGVUaW1lcyIsInRpbWVzIiwiaSIsImluc3RhbGxtZW50IiwicGxhbiIsInRvdGFsIiwiaGVpZ2h0IiwicHVzaCIsInByaWNlIiwic3R5bGUiLCJ3aWR0aCIsIm1vZHVsZSIsImNvbmZpZyIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiJGF1dGhQcm92aWRlciIsIlN0cmlwZSIsInNldFB1Ymxpc2hhYmxlS2V5Iiwic3RhdGUiLCJob21lIiwiYXV0aEVudHJhbmNlIiwiZGFzaGJvYXJkIiwiZGFzaGJvYXJkX3BheW1lbnQiLCJkYXNoYm9hcmRfcGxhbiIsImRhc2hib2FyZF9wbGFuX3N0YXJ0IiwiZGFzaGJvYXJkX3BsYW5fY2hvb3NlIiwiZGFzaGJvYXJkX3BsYW5fc2luZ2xlIiwiZGFzaGJvYXJkX3BsYW5fbXVsdGlwbGUiLCJkYXNoYm9hcmRfYWNjb3VudCIsIm90aGVyd2lzZSIsInZpZXdzIiwibWFpbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInBhcmVudCIsImRhc2hib2FyZF9zZWN0aW9uIiwiZGFzaGJvYXJkX2NoaWxkX3NlY3Rpb24iLCJkb2N1bWVudCIsInJlYWR5IiwiJGluamVjdCIsInNlcnZpY2UiLCJmYWN0b3J5Iiwi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RixLQUFNLHdCQUNOZCxJQUFLLFVBQ0xtSCxPQUFRLGlCQUNSSixPQUNJTSx5QkFDSUosWUFBYSw2Q0FDYkMsV0FBWSxtQkFJcEJQLHVCQUNBN0YsS0FBTSx3QkFDTmQsSUFBSyxpQkFDTG1ILE9BQVEsaUJBQ1JKLE9BQ0lNLHlCQUNJSixZQUFhLDZDQUNiQyxXQUFZLG1CQUlwQk4seUJBQ0E5RixLQUFNLDBCQUNOZCxJQUFLLGtCQUNMbUgsT0FBUSxpQkFDUkosT0FDSU0seUJBQ0lKLFlBQWEsK0NBQ2JDLFdBQVksbUJBSXBCTCxtQkFDQS9GLEtBQU0sb0JBQ05kLElBQUssV0FDTG1ILE9BQVEsWUFDUkosT0FDSUssbUJBQ0lILFlBQWEsK0JBQ2JDLFdBQVksa0JDNUp4QmpJLEdBQUVxSSxVQUFVQyxNQUFNM0ksTUNBbEJnQixRQUFRNEgsU0FBVyxTQUNuQmhILFFBQVFnSCxTQUFXLFNBQ25CN0csTUFBTTZHLFNBQVcsYUFBYyxZQUYvQi9GLFFBQ0ttRSxPQUFPLFlBQ1A2QixRQUFRLFVBQVc3SCxTQUNuQjZILFFBQVEsVUFBV2pILFNBQ25Ca0gsUUFBUSxRQUFTL0csT0NKdEJjLFFBQ0ttRSxPQUFPLFlBQ1ArQixVQUFVLFVBQVczRyxTQ0YxQlMsUUFDS21FLE9BQU8sWUFDUCtCLFVBQVUsVUFBV3JHLFNDRjFCUSxTQUFTMEYsU0FBVyxjQUNwQmhGLFNBQVNnRixTQUFXLFNBQVUsUUFBUyxTQUFVLFVBQVcsV0FDNUQ1RCxjQUFjNEQsU0FBVyxTQUFVLFFBQVMsU0FBVSxVQUFXLGFBQWMsVUFBVyxhQUYxRi9GLFFBQ0ttRSxPQUFPLFlBQ1BzQixXQUFXLFdBQVlwRixVQUN2Qm9GLFdBQVcsV0FBWTFFLFVBQ3ZCMEUsV0FBVyxnQkFBaUJ0RCIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnLCBbXG4gICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAnc2F0ZWxsaXplcicsXG4gICAgICAgICduZ0FuaW1hdGUnLFxuICAgICAgICAvLyAndWkuYm9vdHN0cmFwJyxcbiAgICAgICAgJ25nRmlsZVVwbG9hZCcsXG4gICAgICAgICduZ0ltZ0Nyb3AnLFxuICAgICAgICAnc3RyaXBlLmNoZWNrb3V0JyxcbiAgICAgICAgJ2FuZ3VsYXItbG9hZGluZy1iYXInLFxuICAgICAgICAnYW5pbS1pbi1vdXQnXG4gICAgXSlcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRhdXRoUHJvdmlkZXIpIHtcbiAgICAgICAgU3RyaXBlLnNldFB1Ymxpc2hhYmxlS2V5KCdwa190ZXN0X3QxZVRoaE9LbDZlc3JwNmY0anlXcVU0SicpXG5cbiAgICAgICAgLy8gJGF1dGhQcm92aWRlclxuICAgICAgICAvLyAgICAgLmZhY2Vib29rKHtcbiAgICAgICAgLy8gICAgICAgICBjbGllbnRJZDogJzI5ODE2NTExMzg0OTM2NidcbiAgICAgICAgLy8gICAgIH0pO1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAuc3RhdGUoaG9tZSlcbiAgICAgICAgICAgIC5zdGF0ZShhdXRoRW50cmFuY2UpXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkKVxuICAgICAgICAgICAgLnN0YXRlKGRhc2hib2FyZF9wYXltZW50KVxuICAgICAgICAgICAgLnN0YXRlKGRhc2hib2FyZF9wbGFuKVxuICAgICAgICAgICAgLnN0YXRlKGRhc2hib2FyZF9wbGFuX3N0YXJ0KVxuICAgICAgICAgICAgLnN0YXRlKGRhc2hib2FyZF9wbGFuX2Nob29zZSlcbiAgICAgICAgICAgIC5zdGF0ZShkYXNoYm9hcmRfcGxhbl9zaW5nbGUpXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkX3BsYW5fbXVsdGlwbGUpXG4gICAgICAgICAgICAuc3RhdGUoZGFzaGJvYXJkX2FjY291bnQpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2UpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfcHJvamVjdHMpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfbGlrZWQpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHBhZ2VfZm9sbG93ZXJzKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RwYWdlKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nX2dlbmVyYWwpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHJvamVjdFNldHRpbmdfcmVxdWVzdClcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9qZWN0U2V0dGluZ19wcml2YWN5KVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2plY3RTZXR0aW5nX2RhbmdlcilcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZylcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZ19nZW5lcmFsKVxuICAgICAgICAgICAgLy8gLnN0YXRlKHByb2ZpbGVTZXR0aW5nX3JlcXVlc3QpXG4gICAgICAgICAgICAvLyAuc3RhdGUocHJvZmlsZVNldHRpbmdfcHJpdmFjeSlcbiAgICAgICAgICAgIC8vIC5zdGF0ZShwcm9maWxlU2V0dGluZ19kYW5nZXIpXG5cblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgfSk7XG5cblxubGV0IGhvbWUgPSB7XG4gICAgbmFtZTogJ2hvbWUnLFxuICAgIHVybDogJy8nLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIG1haW46IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvaG9tZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdob21lQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbmxldCBhdXRoRW50cmFuY2UgPSB7XG4gICAgbmFtZTogJ2F1dGhFbnRyYW5jZScsXG4gICAgdXJsOiAnL2VudHJhbmNlJyxcbiAgICB2aWV3czoge1xuICAgICAgICBtYWluOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2VudHJhbmNlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2F1dGhDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZCA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkJyxcbiAgICB1cmw6ICcvZGFzaGJvYXJkJyxcbiAgICB2aWV3czoge1xuICAgICAgICBtYWluOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxuXG5sZXQgZGFzaGJvYXJkX3BheW1lbnQgPSB7XG4gICAgbmFtZTogJ2Rhc2hib2FyZF9wYXltZW50JyxcbiAgICB1cmw6ICcvcGF5bWVudCcsXG4gICAgcGFyZW50OiAnZGFzaGJvYXJkJyxcbiAgICB2aWV3czoge1xuICAgICAgICBkYXNoYm9hcmRfc2VjdGlvbjoge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9kYXNoYm9hcmRfcGF5bWVudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZF9wbGFuID0ge1xuICAgIG5hbWU6ICdkYXNoYm9hcmRfcGxhbicsXG4gICAgdXJsOiAnL3BsYW4nLFxuICAgIHBhcmVudDogJ2Rhc2hib2FyZCcsXG4gICAgdmlld3M6IHtcbiAgICAgICAgZGFzaGJvYXJkX3NlY3Rpb246IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGFzaGJvYXJkX3BsYW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbmxldCBkYXNoYm9hcmRfcGxhbl9zdGFydCA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkX3BsYW5fc3RhcnQnLFxuICAgIHVybDogJy9zdGFydCcsXG4gICAgcGFyZW50OiAnZGFzaGJvYXJkX3BsYW4nLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIGRhc2hib2FyZF9jaGlsZF9zZWN0aW9uOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZC9kYXNoYm9hcmRfcGxhbl9zdGFydC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZF9wbGFuX2Nob29zZSA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkX3BsYW5fY2hvb3NlJyxcbiAgICB1cmw6ICcvY2hvb3NlJyxcbiAgICBwYXJlbnQ6ICdkYXNoYm9hcmRfcGxhbicsXG4gICAgdmlld3M6IHtcbiAgICAgICAgZGFzaGJvYXJkX2NoaWxkX3NlY3Rpb246IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGFzaGJvYXJkL2Rhc2hib2FyZF9wbGFuX2Nob29zZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZF9wbGFuX3NpbmdsZSA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkX3BsYW5fc2luZ2xlJyxcbiAgICB1cmw6ICcvY2hvb3NlL3NpbmdsZScsXG4gICAgcGFyZW50OiAnZGFzaGJvYXJkX3BsYW4nLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIGRhc2hib2FyZF9jaGlsZF9zZWN0aW9uOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZC9kYXNoYm9hcmRfcGxhbl9zaW5nbGUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbmxldCBkYXNoYm9hcmRfcGxhbl9tdWx0aXBsZSA9IHtcbiAgICBuYW1lOiAnZGFzaGJvYXJkX3BsYW5fbXVsdGlwbGUnLFxuICAgIHVybDogJy9jaG9vc2UvbXV0aXBsZScsXG4gICAgcGFyZW50OiAnZGFzaGJvYXJkX3BsYW4nLFxuICAgIHZpZXdzOiB7XG4gICAgICAgIGRhc2hib2FyZF9jaGlsZF9zZWN0aW9uOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Rhc2hib2FyZC9kYXNoYm9hcmRfcGxhbl9tdWx0aXBsZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9XG4gICAgfVxufVxubGV0IGRhc2hib2FyZF9hY2NvdW50ID0ge1xuICAgIG5hbWU6ICdkYXNoYm9hcmRfYWNjb3VudCcsXG4gICAgdXJsOiAnL2FjY291bnQnLFxuICAgIHBhcmVudDogJ2Rhc2hib2FyZCcsXG4gICAgdmlld3M6IHtcbiAgICAgICAgZGFzaGJvYXJkX3NlY3Rpb246IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGFzaGJvYXJkX2FjY291bnQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ3RybCdcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsIid1c2Ugc3RyaWN0J1xuXG4kKGRvY3VtZW50KS5yZWFkeShpbml0KTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBjb25zb2xlLmxvZygnanF1ZXJ5IGxvYWRlZCcpO1xuICAgIHN0aWNreSgpXG4gICAgd2luZG93U2Nyb2xsRG93bigpXG59XG5cbmZ1bmN0aW9uIHN0aWNreSgpIHtcbiAgICAkKFwiLnN0aWNreVwiKS5zdGlja3koe1xuICAgICAgICB0b3BTcGFjaW5nOiA2MFxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIHdpbmRvd1Njcm9sbERvd24oKSB7XG4gICAgdmFyIGxhc3RTY3JvbGxUb3AgPSAwXG4gICAgdmFyIHN0XG4gICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJCh3aW5kb3cpLnNjcm9sbFRvcCgpKTtcbiAgICAgICAgc3QgPSAkKHRoaXMpLnNjcm9sbFRvcCgpO1xuICAgICAgICBpZigkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiAzMCl7XG4gICAgICAgICAgICBpZiAoc3QgPCBsYXN0U2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgICAgJCgnLmhvbWUtcGFnZSBuYXYnKS5yZW1vdmVDbGFzcygnZm9sZGVkJylcbiAgICAgICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLmNzcygnYm9yZGVyLWJvdHRvbScsICcwcHggc29saWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnLmhvbWUtcGFnZSBuYXYnKS5hZGRDbGFzcygnZm9sZGVkJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsYXN0U2Nyb2xsVG9wID0gc3RcblxuICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpIDwgMTApIHtcbiAgICAgICAgICAgICQoJy5ob21lLXBhZ2UgbmF2JykuYWRkQ2xhc3MoJ3RvcCcpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSA+IDEwKSB7XG4gICAgICAgICAgICAkKCcuaG9tZS1wYWdlIG5hdicpLnJlbW92ZUNsYXNzKCd0b3AnKVxuICAgICAgICB9XG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiAzMCkge1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSA8IDU0MCkge1xuICAgICAgICAgICAgJCgnLmhvbWUtcGFnZSBuYXYnKS5jc3MoJ2JveC1zaGFkb3cnLCAnaW5zZXQgMCAtMXB4IDBweCAwcHggcmdiYSgwLDAsMCwwKScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcbiAgICAgICAgICAgICQoJy5ob21lLXBhZ2UgbmF2JykuY3NzKCdib3gtc2hhZG93JywgJ2luc2V0IDAgLTFweCAwcHggMHB4IHJnYmEoMCwwLDAsMC4xKScpO1xuICAgICAgICB9XG5cbiAgICB9KVxufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnKVxuICAgIC5zZXJ2aWNlKCdBY2NvdW50JywgQWNjb3VudClcbiAgICAuc2VydmljZSgnUGF5bWVudCcsIFBheW1lbnQpXG4gICAgLmZhY3RvcnkoJ2ZvY3VzJywgZm9jdXMpXG4gICAgLy8gLmRpcmVjdGl2ZSgnc3RhdGVMb2FkaW5nSW5kaWNhdG9yJywgc3RhdGVMb2FkaW5nSW5kaWNhdG9yKVxuZnVuY3Rpb24gQWNjb3VudCgkaHR0cCkge1xuICAgIHRoaXMuZ2V0Q3VycmVudFVzZXIgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS9hdXRoL2N1cnJlbnRVc2VyYFxuICAgICAgICB9KVxuICAgIH1cbiAgICB0aGlzLnNlbmRWZXJpZnlDb2RlID0gKHVzZXJPYmopID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS92ZXJpZnkvcGhvbmVgLFxuICAgICAgICAgICAgZGF0YTogdXNlck9ialxuICAgICAgICB9KVxuICAgIH1cbiAgICB0aGlzLnZlcmlmeUNvZGUgPSAodXNlck9iaikgPT4ge1xuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgICAgICAgIHVybDogYC9hcGkvdmVyaWZ5L3Bob25lYCxcbiAgICAgICAgICAgIGRhdGE6IHVzZXJPYmpcbiAgICAgICAgfSlcbiAgICB9XG4gICAgdGhpcy5nZXRVc2VyRGF0YSA9ICh1cmlVc2VySWQpID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6IGAvYXBpL3VzZXJzLyR7dXJpVXNlcklkfWBcbiAgICAgICAgfSlcbiAgICB9XG4gICAgdGhpcy51cGRhdGVVc2VyRGF0YSA9ICh1cmlVc2VySWQsIHVwZGF0ZVVzZXJEYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS91c2Vycy8ke3VyaVVzZXJJZH1gLFxuICAgICAgICAgICAgZGF0YTogdXBkYXRlVXNlckRhdGFcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFBheW1lbnQoJGh0dHApe1xuICAgIHRoaXMuY2hhcmdlTm93ID0gKGRhdGFPYmopID0+IHtcbiAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiBgL2FwaS9wYXltZW50L2NoYXJnZU5vd2AsXG4gICAgICAgICAgICBkYXRhOiBkYXRhT2JqXG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5mdW5jdGlvbiBmb2N1cygkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIHJldHVybiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdmb2N1c09uJywgbmFtZSk7XG4gICAgICAgIH0sIDApO1xuICAgIH1cbn1cblxuLy8gZnVuY3Rpb24gc3RhdGVMb2FkaW5nSW5kaWNhdG9yKCRyb290U2NvcGUpIHtcbi8vICAgICByZXR1cm4ge1xuLy8gICAgICAgICByZXN0cmljdDogJ0UnLFxuLy8gICAgICAgICB0ZW1wbGF0ZTogXCI8ZGl2IG5nLXNob3c9J2lzU3RhdGVMb2FkaW5nJyBjbGFzcz0nbG9hZGluZy1pbmRpY2F0b3InPlwiICtcbi8vICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0nbG9hZGluZy1pbmRpY2F0b3ItYm9keSc+XCIgK1xuLy8gICAgICAgICAgICAgXCI8aDMgY2xhc3M9J2xvYWRpbmctdGl0bGUnPkxvYWRpbmcuLi48L2gzPlwiICtcbi8vICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0nc3Bpbm5lcic+PGNoYXNpbmctZG90cy1zcGlubmVyPjwvY2hhc2luZy1kb3RzLXNwaW5uZXI+PC9kaXY+XCIgK1xuLy8gICAgICAgICAgICAgXCI8L2Rpdj5cIiArXG4vLyAgICAgICAgICAgICBcIjwvZGl2PlwiLFxuLy8gICAgICAgICByZXBsYWNlOiB0cnVlLFxuLy8gICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0cnMpIHtcbi8vICAgICAgICAgICAgIHNjb3BlLmlzU3RhdGVMb2FkaW5nID0gZmFsc2U7XG4vL1xuLy8gICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0Jylcbi8vICAgICAgICAgICAgICAgICBzY29wZS5pc1N0YXRlTG9hZGluZyA9IHRydWU7XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbXBsZXRlJylcbi8vICAgICAgICAgICAgICAgICBzY29wZS5pc1N0YXRlTG9hZGluZyA9IGZhbHNlO1xuLy8gICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9O1xuLy8gfVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnKVxuICAgIC5kaXJlY3RpdmUoJ2ZvY3VzT24nLCBmb2N1c09uKVxuXG5mdW5jdGlvbiBmb2N1c09uKCkge1xuICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0cikge1xuICAgICAgICBzY29wZS4kb24oJ2ZvY3VzT24nLCBmdW5jdGlvbihlLCBuYW1lKSB7XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gYXR0ci5mb2N1c09uKSB7XG4gICAgICAgICAgICAgICAgZWxlbVswXS5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgncGluY2hBcHAnKVxuICAgIC5kaXJlY3RpdmUoJ3Rvb2xUaXAnLCB0b29sVGlwKVxuXG5mdW5jdGlvbiB0b29sVGlwKCkge1xuICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCcudG9vbC10aXAnKS5vbignY2xpY2sgbW91c2VsZWF2ZScsIGhpZGVUb29sdGlwKTtcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCcudG9vbC10aXAnKS5vbignbW91c2VlbnRlcicsIHNob3dUb29sdGlwKTtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBoaWRlVG9vbHRpcCgpIHtcbiAgICAkKHRoaXMpLnRvb2x0aXAoJ2hpZGUnKTtcbn1cblxuZnVuY3Rpb24gc2hvd1Rvb2x0aXAoKSB7XG4gICAgJCh0aGlzKS50b29sdGlwKCdzaG93Jyk7XG59XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXJcbiAgICAubW9kdWxlKCdwaW5jaEFwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ2hvbWVDdHJsJywgaG9tZUN0cmwpXG4gICAgLmNvbnRyb2xsZXIoJ2F1dGhDdHJsJywgYXV0aEN0cmwpXG4gICAgLmNvbnRyb2xsZXIoJ2Rhc2hib2FyZEN0cmwnLCBkYXNoYm9hcmRDdHJsKVxuICAgIC8vIC5jb250cm9sbGVyKCduYXZDdHJsJywgbmF2Q3RybClcbiAgICAvLyAuY29udHJvbGxlcigncHBhZ2VDdHJsJywgcHBhZ2VDdHJsKVxuICAgIC8vIC5jb250cm9sbGVyKCdwcm9maWxlU2V0dGluZ0N0cmwnLCBwcm9maWxlU2V0dGluZ0N0cmwpXG4gICAgLy8gLmNvbnRyb2xsZXIoJ3Byb2plY3RwYWdlQ3RybCcsIHByb2plY3RwYWdlQ3RybClcbiAgICAvLyAuY29udHJvbGxlcigncHJvamVjdFNldHRpbmdDdHJsJywgcHJvamVjdFNldHRpbmdDdHJsKVxuXG5cbmZ1bmN0aW9uIGhvbWVDdHJsKCRyb290U2NvcGUpIHtcbiAgICBjb25zb2xlLmxvZygnaG9tZUN0cmwgbG9hZGVkJylcbiAgICAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGVcbiAgICAkcm9vdFNjb3BlLmN1cnJlbnRTdGF0ZVxuICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oZXYsIHRvLCB0b1BhcmFtcywgZnJvbSwgZnJvbVBhcmFtcykge1xuICAgICAgICAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGUgPSBmcm9tLm5hbWU7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFN0YXRlID0gdG8ubmFtZTtcbiAgICAgICAgY29uc29sZS5sb2coJ1ByZXZpb3VzIHN0YXRlOicgKyAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGUpXG4gICAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IHN0YXRlOicgKyAkcm9vdFNjb3BlLmN1cnJlbnRTdGF0ZSlcbiAgICB9KVxuICAgICRyb290U2NvcGUuJG9uKCdhbmltU3RhcnQnLCBmdW5jdGlvbigkZXZlbnQsIGVsZW1lbnQsIHNwZWVkKSB7fSlcbiAgICAkcm9vdFNjb3BlLiRvbignYW5pbUVuZCcsIGZ1bmN0aW9uKCRldmVudCwgZWxlbWVudCwgc3BlZWQpIHt9KVxufVxuXG5mdW5jdGlvbiBhdXRoQ3RybCgkc2NvcGUsICRhdXRoLCAkc3RhdGUsIEFjY291bnQsICR3aW5kb3cpIHtcbiAgICBjb25zb2xlLmxvZygnYXV0aEN0cmwgbG9hZGVkJylcblxuICAgICRzY29wZS5nZXRDdXJyZW50VXNlciA9ICgpID0+IHtcbiAgICAgICAgZ2V0Q3VycmVudFVzZXIoKVxuICAgIH1cblxuICAgICRzY29wZS5hdXRoX2VudGVyID0gKGF1dGhEYXRhKSA9PiB7XG4gICAgICAgICRhdXRoLnNpZ251cChhdXRoRGF0YSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgJGF1dGguc2V0VG9rZW4ocmVzKVxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZGFzaGJvYXJkJywge30sIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkOiB0cnVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIEBhdXRoX2VudGVyOiAnLCByZXMuZGF0YSlcbiAgICAgICAgICAgICAgICBnZXRDdXJyZW50VXNlcigpXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5pbmZvKCdZb3UgaGF2ZSBzdWNjZXNzZnVsbHkgY3JlYXRlZCBhIG5ldyBhY2NvdW50IGFuZCBoYXZlIGJlZW4gc2lnbmVkLWluJyk7XG4gICAgICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgQGF1dGhfZW50ZXI6ICcsIGVycilcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICB9KVxuICAgIH1cblxuICAgICRzY29wZS5hdXRoZW50aWNhdGUgPSAocHJvdmlkZXIpID0+IHtcbiAgICAgICAgJGF1dGguYXV0aGVudGljYXRlKHByb3ZpZGVyKTtcbiAgICB9XG4gICAgJHNjb3BlLmxvZ291dCA9ICgpID0+IHtcbiAgICAgICAgJGF1dGgubG9nb3V0KClcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJywge30sIHtcbiAgICAgICAgICAgIHJlbG9hZDogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKCkge1xuICAgICAgICBpZiAoJGF1dGguZ2V0VG9rZW4oKSkge1xuICAgICAgICAgICAgQWNjb3VudC5nZXRDdXJyZW50VXNlcigkYXV0aC5nZXRUb2tlbigpKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMgQGdldEN1cnJlbnRVc2VyOiAnLCByZXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gcmVzLmRhdGFcbiAgICAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2F1dGhFbnRyYW5jZScpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5mdW5jdGlvbiBkYXNoYm9hcmRDdHJsKCRzY29wZSwgJGF1dGgsICRzdGF0ZSwgQWNjb3VudCwgJHJvb3RTY29wZSwgUGF5bWVudCwgJGludGVydmFsKSB7XG4gICAgY29uc29sZS5sb2coJ2Rhc2hib2FyZEN0cmwgbG9hZGVkJylcbiAgICBBY2NvdW50LmdldEN1cnJlbnRVc2VyKCRhdXRoLmdldFRva2VuKCkpXG4gICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUuY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gcmVzLmRhdGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMgQGdldEN1cnJlbnRVc2VyOiAnLCByZXMuZGF0YSlcbiAgICAgICAgICAgIGNoZWNrVmVyaWZ5UGhvbmVTZW50U3RhdHVzKHJlcy5kYXRhKVxuICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJylcbiAgICAgICAgfSlcblxuICAgIGZ1bmN0aW9uIGNoZWNrVmVyaWZ5UGhvbmVTZW50U3RhdHVzKGN1cnJlbnRVc2VyRGF0YSkge1xuICAgICAgICAkc2NvcGUudmVyaWZ5UGhvbmVTZW50T3V0ID0gZmFsc2VcblxuICAgICAgICBsZXQgZXhwaXJlZFRpbWUgPSBOdW1iZXIoY3VycmVudFVzZXJEYXRhLnBob25lLnZlcmlmeUNvZGUuZXhwaXJlZEF0KVxuICAgICAgICBsZXQgbm93VGltZSA9IERhdGUubm93KClcbiAgICAgICAgaWYgKGV4cGlyZWRUaW1lID4gbm93VGltZSkge1xuICAgICAgICAgICAgJHNjb3BlLnZlcmlmeVBob25lU2VudE91dCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLnZlcmlmeVBob25lQ291bnREb3duID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGAke2V4cGlyZWRUaW1lfWBcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRzY29wZS5zZW5kVmVyaWZ5Q29kZSA9IChwaG9uZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygncGhvbmU6ICcsIHBob25lKVxuICAgICAgICBpZiAocGhvbmUubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgdmFyIHVzZXJPYmogPSB7XG4gICAgICAgICAgICAgICAgdXNlckRhdGE6ICRyb290U2NvcGUuY3VycmVudFVzZXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6IHBob25lXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBBY2NvdW50LnNlbmRWZXJpZnlDb2RlKHVzZXJPYmopXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlcyBAc2VuZFZlcmlmeUNvZGU6ICcsIHJlcy5kYXRhKVxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLnBob25lLmRhdGEgPSBwaG9uZTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlcmlmeVBob25lU2VudE91dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciBAc2VuZFZlcmlmeUNvZGU6ICcsIGVycik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudmVyaWZ5Q29kZSA9IChjb2RlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb2RlOiAnLCBjb2RlKVxuICAgICAgICBpZiAoY29kZS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIHZhciB1c2VyT2JqID0ge1xuICAgICAgICAgICAgICAgIHVzZXJEYXRhOiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgICAgIGNvZGU6IGNvZGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEFjY291bnQudmVyaWZ5Q29kZSh1c2VyT2JqKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMgQHZlcmlmeUNvZGU6ICcsIHJlcy5kYXRhKVxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLnBob25lLnZlcmlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyIEB2ZXJpZnlDb2RlOiAnLCBlcnIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuZG9DaGVja291dCA9ICh0b2tlbikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnZmZmJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0b2tlbjogJywgdG9rZW4pO1xuICAgICAgICB2YXIgZGF0YU9iaiA9IHtcbiAgICAgICAgICAgIHN0cmlwZVRva2VuOiB0b2tlbixcbiAgICAgICAgICAgIHVzZXJEYXRhOiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyXG4gICAgICAgIH1cbiAgICAgICAgUGF5bWVudC5jaGFyZ2VOb3coZGF0YU9iaikudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlczogJywgcmVzLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI6ICcsIGVycik7XG4gICAgICAgIH0pXG4gICAgfVxuICAgICRzY29wZS5pbnN0YWxsbWVudHNHcmFwaERhdGEgPSBbXTtcbiAgICAkc2NvcGUudXBkYXRlVGltZXMgPSAodGltZXMpID0+IHtcbiAgICAgICAgJHNjb3BlLmluc3RhbGxtZW50c0dyYXBoRGF0YSA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRpbWVzOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpbnN0YWxsbWVudCA9IH5+KCgkc2NvcGUucGxhbi50b3RhbCAvIHRpbWVzKSk7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gfn4oMjAwICogKDIgLyB0aW1lcykpXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB+fig5MCAvIGluc3RhbGxtZW50KVxuXG4gICAgICAgICAgICAkc2NvcGUuaW5zdGFsbG1lbnRzR3JhcGhEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgIHByaWNlOiBpbnN0YWxsbWVudCxcbiAgICAgICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGAke2hlaWdodH1weGAsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBgOTAlYFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG59XG5cblxuLy8gZnVuY3Rpb24gcHJvamVjdFNldHRpbmdDdHJsKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgUHJvamVjdCwgJHN0YXRlLCAkbG9jYXRpb24pIHtcbi8vICAgICBjb25zb2xlLmxvZygncHJvamVjdFNldHRpbmdDdHJsIGxvYWRlZCcpO1xuLy8gICAgIHZhciBpc0F1dGhvciA9IGZhbHNlO1xuLy8gICAgIHZhciBwcm9qZWN0SWQgPSAkc3RhdGVQYXJhbXMucHJvamVjdElkO1xuLy9cbi8vICAgICBQcm9qZWN0LmdldE9uZVBvcmplY3QocHJvamVjdElkKS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0czogJywgcmVzLmRhdGEpO1xuLy8gICAgICAgICAkc2NvcGUucHJvamVjdCA9IHJlcy5kYXRhO1xuLy8gICAgICAgICAkc2NvcGUudXBkYXRlUHJvamVjdERhdGEgPSAkc2NvcGUucHJvamVjdDtcbi8vICAgICAgICAgJHNjb3BlLnByb2plY3QuYXV0aG9yLmZvckVhY2goYXV0aG9yID0+IHtcbi8vICAgICAgICAgICAgIC8vIGluIGNhc2UsIHByb2plY3QgaGFzIG11dGlwbGUgYXV0aG9yc1xuLy8gICAgICAgICAgICAgaWYgKGF1dGhvci5faWQgPT0gJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQpIHtcbi8vICAgICAgICAgICAgICAgICBpc0F1dGhvciA9IHRydWU7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH0pXG4vLyAgICAgICAgIGlmIChpc0F1dGhvcikge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2lzQXV0aG9yJyk7XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnaXMgbm90IEF1dGhvcicpO1xuLy8gICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnZXJyIHdoZW4gZ2V0IHRoaXMgcHJvamVjdDogJywgZXJyKTtcbi8vICAgICB9KVxuLy8gICAgICRzY29wZS5yZXF1ZXN0ID0ge1xuLy8gICAgICAgICBwZW9wbGU6IFtdLFxuLy8gICAgICAgICBzdXBwbHk6IFtdLFxuLy8gICAgICAgICBtb25leTogW11cbi8vICAgICB9O1xuLy9cbi8vICAgICAkc2NvcGUuaW5pdCA9ICgpID0+IHtcbi8vICAgICAgICAgdmFyIGNoZWNrVXJsID0gJGxvY2F0aW9uLiQkcGF0aC5pbmNsdWRlcygnZGFuZ2VyJykgfHwgJGxvY2F0aW9uLiQkcGF0aC5pbmNsdWRlcygncmVxdWVzdCcpIHx8ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ3ByaXZhY3knKVxuLy8gICAgICAgICBpZiAoIWNoZWNrVXJsKSB7XG4vLyAgICAgICAgICAgICAkc3RhdGUuZ28oJ3Byb2plY3RTZXR0aW5nX2dlbmVyYWwnKTtcbi8vICAgICAgICAgfVxuLy8gICAgIH07XG4vL1xuLy8gICAgICRzY29wZS5hZGRDaG9pY2VUb1Blb3BsZSA9IChwZW9wbGUpID0+IHtcbi8vICAgICAgICAgaWYgKCRzY29wZS5yZXF1ZXN0LnBlb3BsZS5pbmRleE9mKHBlb3BsZSkgIT09IC0xKSB7XG4vLyAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdC5wZW9wbGUuc3BsaWNlKCRzY29wZS5yZXF1ZXN0LnBlb3BsZS5pbmRleE9mKHBlb3BsZSksIDEpO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3QucGVvcGxlLnB1c2gocGVvcGxlKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVxdWVzdC5wZW9wbGUpO1xuLy8gICAgIH07XG4vL1xuLy8gICAgICRzY29wZS5hZGRDaG9pY2VUb1N1cHBseSA9IChzdXBwbHkpID0+IHtcbi8vICAgICAgICAgaWYgKCRzY29wZS5yZXF1ZXN0LnN1cHBseS5pbmRleE9mKHN1cHBseSkgIT09IC0xKSB7XG4vLyAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdC5zdXBwbHkuc3BsaWNlKCRzY29wZS5yZXF1ZXN0LnN1cHBseS5pbmRleE9mKHN1cHBseSksIDEpO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3Quc3VwcGx5LnB1c2goc3VwcGx5KTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVxdWVzdC5zdXBwbHkpO1xuLy8gICAgIH1cbi8vICAgICAkc2NvcGUuYWRkQ2hvaWNlVG9Nb25leSA9IChtb25leSkgPT4ge1xuLy8gICAgICAgICBpZiAoJHNjb3BlLnJlcXVlc3QubW9uZXkuaW5kZXhPZihtb25leSkgIT09IC0xKSB7XG4vLyAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdC5tb25leS5zcGxpY2UoJHNjb3BlLnJlcXVlc3QubW9uZXkuaW5kZXhPZihtb25leSksIDEpO1xuLy8gICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3QubW9uZXkgPSBbXTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0Lm1vbmV5ID0gW107XG4vLyAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdC5tb25leS5wdXNoKG1vbmV5KTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVxdWVzdC5tb25leSk7XG4vLyAgICAgfVxuLy8gICAgICRzY29wZS5kZWxldGVQcm9qZWN0ID0gKHByb2plY3RGdWxsTmFtZSkgPT4ge1xuLy8gICAgICAgICBpZiAoJHNjb3BlLmRlbGV0ZVByb2plY3RJbnB1dCA9PSBwcm9qZWN0RnVsbE5hbWUpIHtcbi8vICAgICAgICAgICAgIGxldCBwcm9qZWN0SWQgPSAkc3RhdGVQYXJhbXMucHJvamVjdElkO1xuLy8gICAgICAgICAgICAgUHJvamVjdC5kZWxldGVPbmUocHJvamVjdElkKS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2plY3QgZGVsZXRlZCcpO1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXM6ICcsIHJlcy5kYXRhKTtcbi8vICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3BwYWdlJywge1xuLy8gICAgICAgICAgICAgICAgICAgICB1c2VySWQ6ICRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkXG4vLyAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGlzIG5vdCBsb2dnZWQgaW4uJyk7XG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ25vJyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5kYW5nZXJOb3RpZmllZCA9IGZhbHNlO1xuLy8gICAgICRzY29wZS5kYW5nZXJOb3RpZnR5ID0gKCkgPT4ge1xuLy8gICAgICAgICAkc2NvcGUuZGFuZ2VyTm90aWZpZWQgPSAhJHNjb3BlLmRhbmdlck5vdGlmaWVkO1xuLy8gICAgIH1cbi8vICAgICAkc2NvcGUuc2FtZVRvVGhlUHJvamVjdE5hbWUgPSAocHJvamVjdEZ1bGxOYW1lKSA9PiB7XG4vLyAgICAgICAgIHJldHVybiAkc2NvcGUuZGVsZXRlUHJvamVjdElucHV0ID09IHByb2plY3RGdWxsTmFtZTtcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLm9rYXlUb0RlbGV0ZSA9IChwcm9qZWN0RnVsbE5hbWUpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJyRzY29wZS5kYW5nZXJOb3RpZmllZDogJywgJHNjb3BlLmRhbmdlck5vdGlmaWVkKTtcbi8vICAgICAgICAgcmV0dXJuICRzY29wZS5kZWxldGVQcm9qZWN0SW5wdXQgPT0gcHJvamVjdEZ1bGxOYW1lICYmICRzY29wZS5kYW5nZXJOb3RpZmllZDtcbi8vICAgICB9XG4vLyB9XG4vL1xuLy8gZnVuY3Rpb24gcHJvamVjdHBhZ2VDdHJsKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgUHJvamVjdCkge1xuLy8gICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0cGFnZUN0cmwgbG9hZGVkJyk7XG4vLyAgICAgJHNjb3BlLnN0YXRlID0ge31cbi8vICAgICAkc2NvcGUuc3RhdGUuaXNBdXRob3IgPSBmYWxzZVxuLy8gICAgIHZhciBwcm9qZWN0SWQgPSAkc3RhdGVQYXJhbXMucHJvamVjdElkO1xuLy8gICAgIC8vIGNvbnNvbGUubG9nKCdwcm9qZWN0SWQ6ICcsIHByb2plY3RJZCk7XG4vLyAgICAgUHJvamVjdC5nZXRPbmVQb3JqZWN0KHByb2plY3RJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZygncHJvamVjdERhdGE6ICcsIHJlcy5kYXRhKTtcbi8vICAgICAgICAgJHNjb3BlLnByb2plY3QgPSByZXMuZGF0YVxuLy8gICAgICAgICBjb25zb2xlLmxvZygnJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQ6ICcsICRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkKVxuLy8gICAgICAgICBjb25zb2xlLmxvZygnJHNjb3BlLnByb2plY3QuYXV0aG9yOiAnLCAkc2NvcGUucHJvamVjdC5hdXRob3IpXG4vLyAgICAgICAgIHZhciBhdXRob3JzID0gcmVzLmRhdGEuYXV0aG9yXG4vLyAgICAgICAgIGZvciAodmFyIGF1dGhvciBpbiBhdXRob3JzKSB7XG4vLyAgICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQgPT0gYXV0aG9yc1thdXRob3JdLl9pZCkge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc3RhdGUuaXNBdXRob3IgPSB0cnVlO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGdldCB0aGlzIHByb2plY3Q6ICcsIGVycik7XG4vLyAgICAgfSlcbi8vICAgICAkc2NvcGUubGlrZSA9IChsaWtlcklkLCBwcm9qZWN0SWQpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2cobGlrZXJJZCwgJ2NsaWNrcyBsaWtlQnRuIG9mJywgcHJvamVjdElkKTtcbi8vICAgICAgICAgaWYgKCRzY29wZS5zdGF0ZS5pc0F1dGhvcikge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2xpa2VFdmVudCB0cmlnZ2VyZWQnKVxuLy8gICAgICAgICAgICAgUHJvamVjdC5saWtlKHByb2plY3RJZCwgbGlrZXJJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlczogJywgcmVzKTtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChyZXMuZGF0YS5ldmVudFR5cGUgPT0gJ2ZvbGxvdycpIHtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2snKTtcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnZm9sbHdpbmc6IHJlcywgJywgcmVzLmRhdGEpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGZvbGxvd2VyID0gcmVzLmRhdGEuZm9sbG93ZXJcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB2YXIgZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS5mb2xsb3dpbmdSZWNlaXZlclxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3QucHVzaChmb2xsb3dlcilcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjaGVja0ZvbGxvd1N0YXR1cygpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLmV2ZW50VHlwZSA9PSAndW5mb2xsb3cnKSB7XG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrJyk7XG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ3VuZm9sbHdpbmc6IHJlcywgJywgcmVzLmRhdGEpXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIHVuZm9sbG93ZXIgPSByZXMuZGF0YS51bmZvbGxvd2VyXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIHVuZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS51bmZvbGxvd2luZ1JlY2VpdmVyXG4vLyAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGluZGV4ID0gJHNjb3BlLnVzZXIuZm9sbG93ZXJzTGlzdC5pbmRleE9mKGZvbGxvd2VyKVxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3Quc3BsaWNlKGluZGV4LCAxKVxuLy8gICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNoZWNrRm9sbG93U3RhdHVzKClcbi8vICAgICAgICAgICAgICAgICAvLyAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH0sIGVyciA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGxpa2UvdW5saWtlOiAnLCBlcnIpXG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuLy9cbi8vIGZ1bmN0aW9uIHByb2ZpbGVTZXR0aW5nQ3RybCgkc2NvcGUsICRodHRwLCAkc3RhdGVQYXJhbXMsIEFjY291bnQsICRzdGF0ZSwgJHdpbmRvdywgVXBsb2FkLCAkbG9jYXRpb24pIHtcbi8vICAgICBjb25zb2xlLmxvZygncHJvZmlsZVNldHRpbmdDdHJsIGxvYWRlZCcpO1xuLy9cbi8vICAgICBpZiAoJHN0YXRlUGFyYW1zLnVzZXJJZCA9PSAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLl9pZCkge1xuLy8gICAgICAgICAvLyBjb25zb2xlLmxvZygnaXNBdXRoVXNlcicpO1xuLy8gICAgICAgICAkc2NvcGUudXBkYXRlVXNlckRhdGEgPSBhbmd1bGFyLmNvcHkoJHJvb3RTY29wZS5jdXJyZW50VXNlcik7XG4vLyAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgLy8gY29uc29sZS5sb2coJ2lzIG5vdCBBdXRoVXNlcicpO1xuLy8gICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbi8vICAgICB9XG4vLyAgICAgJHNjb3BlLmluaXQgPSAoKSA9PiB7XG4vLyAgICAgICAgIHZhciBjaGVja1VybCA9ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ2RhbmdlcicpIHx8ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ3JlcXVlc3QnKSB8fCAkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdwcml2YWN5Jylcbi8vICAgICAgICAgaWYgKCFjaGVja1VybCkge1xuLy8gICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlU2V0dGluZ19nZW5lcmFsJyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9O1xuLy9cbi8vICAgICAkc2NvcGUudXBkYXRlVXNlckRhdGFTdWJtaXR0ZWQgPSAoKSA9PiB7XG4vLyAgICAgICAgIHZhciB1cmlVc2VySWQgPSAkc2NvcGUudXBkYXRlVXNlckRhdGEuX2lkO1xuLy8gICAgICAgICB2YXIgdXBkYXRlVXNlckRhdGEgPSAkc2NvcGUudXBkYXRlVXNlckRhdGE7XG4vLyAgICAgICAgIEFjY291bnQudXBkYXRlVXNlckRhdGEodXJpVXNlcklkLCB1cGRhdGVVc2VyRGF0YSkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZVVzZXJEYXRhID0gcmVzLmRhdGE7XG4vLyAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGdldCB1cGRhdGUgdXNlciBkYXRhOiAnLCBlcnIpO1xuLy8gICAgICAgICB9KVxuLy8gICAgIH1cbi8vICAgICAkc2NvcGUucGhvdG9VcGxvYWRpbmcgPSBmYWxzZVxuLy8gICAgICRzY29wZS51cGxvYWRGaWxlcyA9IChmaWxlKSA9PiB7XG4vLyAgICAgICAgICRzY29wZS5waG90b1VwbG9hZGluZyA9IHRydWU7XG4vLyAgICAgICAgIHZhciBmaWxlID0gZmlsZVswXVxuLy8gICAgICAgICB2YXIgdXNlcklkID0gJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQ7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdwaG90bzogJywgZmlsZSk7XG4vLyAgICAgICAgIGlmIChmaWxlKSB7XG4vLyAgICAgICAgICAgICBVcGxvYWQudXBsb2FkKHtcbi8vICAgICAgICAgICAgICAgICB1cmw6IGAvYXBpL3VwbG9hZC8ke3VzZXJJZH1gLFxuLy8gICAgICAgICAgICAgICAgIGRhdGE6IHtcbi8vICAgICAgICAgICAgICAgICAgICAgbmV3RmlsZTogZmlsZVxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzIGFmdGVyIHVwbG9hZDogJywgcmVzLmRhdGEpO1xuLy8gICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiB1cGxvYWQgZmlsZTogJywgZXJyKTtcbi8vICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gfVxuLy9cbi8vIGZ1bmN0aW9uIHBwYWdlQ3RybCgkc2NvcGUsICRzdGF0ZSwgJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zLCBQcm9qZWN0LCBBY2NvdW50LCAkdGltZW91dCwgJGxvY2F0aW9uKSB7XG4vLyAgICAgY29uc29sZS5sb2coJ3BwYWdlQ3RybCBsb2FkZWQnKVxuLy8gICAgICRzY29wZS5zdGF0ZSA9IHt9XG4vLyAgICAgJHNjb3BlLnN0YXRlLmlzVGhlVXNlciA9IGZhbHNlXG4vLyAgICAgJHNjb3BlLnN0YXRlLmZvbGxvd1N0YXR1cyA9IGZhbHNlXG4vLyAgICAgdmFyIGRpc3BsYXlVc2VyO1xuLy8gICAgIHZhciB1cmlVc2VySWQgPSAkc3RhdGVQYXJhbXMudXNlcklkO1xuLy8gICAgIGlmICh1cmlVc2VySWQgPT0gJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQpIHtcbi8vICAgICAgICAgJHNjb3BlLnN0YXRlLmlzVGhlVXNlciA9IHRydWU7XG4vLyAgICAgfVxuLy8gICAgIGlmICgkc2NvcGUuc3RhdGUuaXNUaGVVc2VyKSB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdpc1RoZVVzZXInKVxuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdpcyBub3QgVGhlVXNlcicpXG4vLyAgICAgfVxuLy8gICAgICRzY29wZS5pbml0ID0gKCkgPT4ge1xuLy8gICAgICAgICBjaGVja2luZ1VybCgpXG4vLyAgICAgfVxuLy9cbi8vICAgICBmdW5jdGlvbiBjaGVja2luZ1VybCgpIHtcbi8vICAgICAgICAgdmFyIGNoZWNrVXJsID0gJGxvY2F0aW9uLiQkcGF0aC5pbmNsdWRlcygnc3RhcnJlZCcpIHx8ICRsb2NhdGlvbi4kJHBhdGguaW5jbHVkZXMoJ2ZvbGxvd2VycycpXG4vLyAgICAgICAgIGlmICghY2hlY2tVcmwpIHtcbi8vICAgICAgICAgICAgICRzdGF0ZS5nbygncHBhZ2VfcHJvamVjdHMnKTtcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vICAgICBBY2NvdW50LmdldFVzZXJEYXRhKHVyaVVzZXJJZCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAkc2NvcGUudXNlciA9IHJlcy5kYXRhXG4vLyAgICAgICAgIGRpc3BsYXlVc2VyID0gcmVzLmRhdGFcbi8vICAgICAgICAgJHNjb3BlLnByb2plY3RzID0gcmVzLmRhdGEucHJvamVjdHMucmV2ZXJzZSgpO1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnY2FyZHMgaGVyZTogJywgcmVzLmRhdGEucHJvamVjdHMpO1xuLy8gICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbi8vICAgICAgICAgICAgIGNoZWNrRm9sbG93U3RhdHVzKClcbi8vICAgICAgICAgfSwgMClcbi8vICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnZXJyIHdoZW4gZ2V0IHVzZXJEYXRhOiAnLCBlcnIpO1xuLy8gICAgIH0pXG4vL1xuLy8gICAgICRzY29wZS5jcmVhdGVUaW1lID0gKGNyZWF0ZUF0VGltZSkgPT4ge1xuLy8gICAgICAgICByZXR1cm4gbW9tZW50KGNyZWF0ZUF0VGltZSkuZnJvbU5vdygpO1xuLy8gICAgIH1cbi8vXG4vLyAgICAgJHNjb3BlLmZvbGxvdyA9IChjdXJyZW50VXNlciwgZm9sbG93VGFyZ2V0KSA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdmZmZmZmYnKTtcbi8vICAgICAgICAgY29uc29sZS5sb2coY3VycmVudFVzZXIsIGZvbGxvd1RhcmdldCk7XG4vLyAgICAgICAgIGlmIChjdXJyZW50VXNlciAhPT0gZm9sbG93VGFyZ2V0ICYmIGZvbGxvd1RhcmdldCA9PSB1cmlVc2VySWQpIHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmb2xsb3dFdmVudCB0cmlnZ2VyZWQnKVxuLy8gICAgICAgICAgICAgQWNjb3VudC5mb2xsb3coY3VycmVudFVzZXIsIGZvbGxvd1RhcmdldCkudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXM6ICcsIHJlcyk7XG4vLyAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLmV2ZW50VHlwZSA9PSAnZm9sbG93Jykge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2snKTtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZvbGx3aW5nOiByZXMsICcsIHJlcy5kYXRhKVxuLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZm9sbG93ZXIgPSByZXMuZGF0YS5mb2xsb3dlclxuLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZm9sbG93aW5nUmVjZWl2ZXIgPSByZXMuZGF0YS5mb2xsb3dpbmdSZWNlaXZlclxuLy8gICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5mb2xsb3dlcnNMaXN0LnB1c2goZm9sbG93ZXIpXG4vLyAgICAgICAgICAgICAgICAgICAgIGNoZWNrRm9sbG93U3RhdHVzKClcbi8vICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLmV2ZW50VHlwZSA9PSAndW5mb2xsb3cnKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVjaycpO1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndW5mb2xsd2luZzogcmVzLCAnLCByZXMuZGF0YSlcbi8vICAgICAgICAgICAgICAgICAgICAgdmFyIHVuZm9sbG93ZXIgPSByZXMuZGF0YS51bmZvbGxvd2VyXG4vLyAgICAgICAgICAgICAgICAgICAgIHZhciB1bmZvbGxvd2luZ1JlY2VpdmVyID0gcmVzLmRhdGEudW5mb2xsb3dpbmdSZWNlaXZlclxuLy8gICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkc2NvcGUudXNlci5mb2xsb3dlcnNMaXN0LmluZGV4T2YoZm9sbG93ZXIpXG4vLyAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmZvbGxvd2Vyc0xpc3Quc3BsaWNlKGluZGV4LCAxKVxuLy8gICAgICAgICAgICAgICAgICAgICBjaGVja0ZvbGxvd1N0YXR1cygpXG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfSwgZXJyID0+IHtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyIHdoZW4gZm9sbG93L3VuZm9sbG93OiAnLCBlcnIpXG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gICAgIHZhciBjaGVja0ZvbGxvd1N0YXR1cyA9ICgpID0+IHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja0ZvbGxvd1N0YXR1cyB0cmlnZXJyZWQnKTtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkaXNwbGF5VXNlcjogJywgZGlzcGxheVVzZXIpO1xuLy8gICAgICAgICAgICAgaWYgKGRpc3BsYXlVc2VyLmZvbGxvd2Vyc0xpc3QubGVuZ3RoID4gMCkge1xuLy8gICAgICAgICAgICAgICAgIHZhciBmb2xsb3dlcnNMaXN0ID0gZGlzcGxheVVzZXIuZm9sbG93ZXJzTGlzdFxuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkJyk7XG4vLyAgICAgICAgICAgICAgICAgZm9yICh2YXIgZm9sbG93ZXIgaW4gZm9sbG93ZXJzTGlzdCkge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3VycmVudFVzZXI6ICcsICRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkKTtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZvbGxvd2Vyc0xpc3RbZm9sbG93ZXJdLl9pZDogJywgZm9sbG93ZXJzTGlzdFtmb2xsb3dlcl0uX2lkKTtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKGZvbGxvd2Vyc0xpc3RbZm9sbG93ZXJdLl9pZCA9PSAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLl9pZCkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YXRlLmZvbGxvd1N0YXR1cyA9IHRydWVcbi8vICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0ZS5mb2xsb3dTdGF0dXMgPSBmYWxzZVxuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdGUuZm9sbG93U3RhdHVzID0gZmFsc2Vcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfVxuLy8gICAgICAgICAvLyBjaGVja0ZvbGxvd1N0YXR1cygpXG4vLyB9XG4vL1xuLy8gZnVuY3Rpb24gbmF2Q3RybCgkaHR0cCwgJHNjb3BlLCAkYXV0aCwgQWNjb3VudCwgJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgZm9jdXMsIFByb2plY3QsICRsb2NhdGlvbikge1xuLy8gICAgIC8vIGNvbnNvbGUubG9nKCduYXZDdHJsIGxvYWRlZCcpO1xuLy8gICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSAnJztcbi8vICAgICAkc2NvcGUubG9naW5sb2FkaW5nID0gZmFsc2U7XG4vLyAgICAgJHNjb3BlLmxvZ291dGxvYWRpbmcgPSBmYWxzZTtcbi8vICAgICAkcm9vdFNjb3BlLmhpZGVOYXYgPSBmYWxzZTtcbi8vICAgICAkcm9vdFNjb3BlLmNyZWF0ZU1vZGFsID0gZmFsc2U7XG4vL1xuLy8gICAgICRzY29wZS5hdXRoZW50aWNhdGUgPSAocHJvdmlkZXIpID0+IHtcbi8vICAgICAgICAgICAgICRzY29wZS5sb2dpbmxvYWRpbmcgPSB0cnVlO1xuLy8gICAgICAgICAgICAgJGF1dGguYXV0aGVudGljYXRlKHByb3ZpZGVyKS50aGVuKGRhdGEgPT4ge1xuLy8gICAgICAgICAgICAgICAgIEFjY291bnQuZ2V0Q3VycmVudFVzZXIoKS50aGVuKHJlcyA9PiB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGxvZ2dlZCBpbjogJywgcmVzLmRhdGEpO1xuLy8gICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gcmVzLmRhdGE7XG4vLyAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2dpbmxvYWRpbmcgPSBmYWxzZTtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkOiAnLCAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLl9pZCk7XG4vLyAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lID09ICdob21lJykge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcGFnZScsIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6ICRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXNlciBpcyBub3QgbG9nZ2VkIGluLicpO1xuLy8gICAgICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnIgd2hlbiBsb2cgdXNlciBpbjogJywgZXJyKTtcbi8vICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgLy8gY29uc29sZS5sb2coJyRhdXRoLmlzQXV0aGVudGljYXRlZCgpKTogJywgJGF1dGguaXNBdXRoZW50aWNhdGVkKCkpKTtcbi8vICAgICBpZiAoJGF1dGguaXNBdXRoZW50aWNhdGVkKCkpIHtcbi8vICAgICAgICAgQWNjb3VudC5nZXRDdXJyZW50VXNlcigpLnRoZW4ocmVzID0+IHtcbi8vICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSByZXMuZGF0YTtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCduYXZDdHJsIHRyaWdnZXJlZCBhbmQgY3VycmVudFVzZXI6ICcsICRyb290U2NvcGUuY3VycmVudFVzZXIpO1xuLy8gICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXIgaXMgbm90IGxvZ2dlZCBpbi4nKTtcbi8vICAgICAgICAgfSlcbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5pc0F1dGhlbnRpY2F0ZWQgPSAoKSA9PiB7XG4vLyAgICAgICAgIHJldHVybiAkYXV0aC5pc0F1dGhlbnRpY2F0ZWQoKTtcbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5sb2dvdXQgPSAoKSA9PiB7XG4vLyAgICAgICAgICRzY29wZS5sb2dvdXRsb2FkaW5nID0gdHJ1ZTtcbi8vICAgICAgICAgJGF1dGgubG9nb3V0KCk7XG4vLyAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICAgJHNjb3BlLmxvZ291dGxvYWRpbmcgPSBmYWxzZTtcbi8vICAgICAgICAgICAgIC8vICRzdGF0ZS5nbygnaG9tZScpO1xuLy8gICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbi8vICAgICAgICAgfSwgMClcbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5nb3BwYWdlID0gKCkgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnJGxvY2F0aW9uLiQkcGF0aDogJywgJGxvY2F0aW9uLiQkcGF0aCk7XG4vLyAgICAgICAgIGlmICgkbG9jYXRpb24uJCRwYXRoLmluY2x1ZGVzKCdwcm9qZWN0cycpKSB7XG4vLyAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc3RheSBvbiB0aGUgcGFnZSwgb3IgcmVmcmVzaCB0aGUgcGFnZScpXG4vLyAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAkc3RhdGUuZ28oJ3BwYWdlJywge1xuLy8gICAgICAgICAgICAgICAgIHVzZXJJZDogJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWRcbi8vICAgICAgICAgICAgIH0pXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gICAgICRzY29wZS5jcmVhdGUgPSAoKSA9PiB7XG4vLyAgICAgICAgICRzY29wZS5wcm9qZWN0SW5pdGFsaXppbmcgPSBmYWxzZTtcbi8vICAgICAgICAgJHNjb3BlLm5ld1Byb2plY3ROYW1lID0gJyc7XG4vLyAgICAgICAgICRzY29wZS5uZXdQcm9qZWN0UGl0Y2ggPSAnJztcbi8vICAgICAgICAgJHNjb3BlLmNyZWF0ZU1vZGFsID0gdHJ1ZTtcbi8vICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgICAgICBmb2N1cygnZm9jdXNNZScpO1xuLy8gICAgICAgICB9LCAxMDApXG4vLyAgICAgfVxuLy8gICAgICRzY29wZS5jcmVhdGVQcm9qZWN0ID0gKCkgPT4ge1xuLy8gICAgICAgICAkc2NvcGUucHJvamVjdEluaXRhbGl6aW5nID0gdHJ1ZTtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZSBwcm9qZWN0IGNhbGxlZDogJywgJHNjb3BlLm5ld1Byb2plY3ROYW1lKTtcbi8vICAgICAgICAgdmFyIG5ld1BvamVjdE9iaiA9IHtcbi8vICAgICAgICAgICAgIHRpdGxlOiAkc2NvcGUubmV3UHJvamVjdE5hbWUsXG4vLyAgICAgICAgICAgICBwaXRjaDogJHNjb3BlLm5ld1Byb2plY3RQaXRjaFxuLy8gICAgICAgICB9XG4vLyAgICAgICAgIFByb2plY3QuY3JlYXRlT25lKG5ld1BvamVjdE9iaikudGhlbihyZXMgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCBuZXcgYmVoYXZpb3JbY3JlYXRlTmV3UHJvamVjdF06ICcsIHJlcy5kYXRhKTtcbi8vICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICAgICAgICRzY29wZS5wcm9qZWN0SW5pdGFsaXppbmcgPSBmYWxzZTtcbi8vICAgICAgICAgICAgICAgICAkc2NvcGUuY3JlYXRlTW9kYWwgPSBmYWxzZTtcbi8vICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlLmN1cnJlbnQubmFtZSA9PSAncHBhZ2UnKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4vLyAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcGFnZScsIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWRcbi8vICAgICAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfSwgTWF0aC5yYW5kb20oKSAqIDE1MDAgKyAzMDApO1xuLy8gICAgICAgICB9LCBlcnIgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coJ2VyciB3aGVuIGNyZWF0ZSBwcm9qZWN0OiAnLCBlcnIpO1xuLy8gICAgICAgICB9KVxuLy8gICAgIH1cbi8vIH1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
